<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>é‹å‘½ã®éŠ€ç«œæš¦ï½œä»Šæ—¥ã®å ã„ã‚’å—ã‘å–ã‚‹</title>
  <meta name="description" content="éŠ€ç«œã®è¨€è‘‰ã‚’ç¶™ãè€…ã¸ã€‚ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§ä»Šæ—¥ã®å ã„ã€ç‰©èªã€ç«œã®é£Ÿå“ã€‚ç„¡æ–™ã¯ç·åˆã€æœ‰æ–™ã§9ã‚«ãƒ†ã‚´ãƒªãŒé–‹æ”¾ã€‚">
  <style>
    html { font-size: 16px; }
    :root{
      --bg:#0b0d12; --ink:#ffffff; --muted:#aeb7d0; --line:#27304a; --card:#151826;
      --accent:#9fd3ff; --accent-2:#1a3358; --accent-2-b:#34507c;
      --radius:.875rem; --pad:1rem; --gap:.75rem; --tap:2.75rem;
      --success:#6bd8a6; --warning:#ffd27e;
    }
    *{ box-sizing:border-box }
    body{ margin:0; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif; line-height:1.75; -webkit-text-size-adjust:100%; text-rendering:optimizeLegibility; }
    .wrap{ max-width:40rem; margin:0 auto; padding:1rem; }

    /* ===== Hero ===== */
    .hero{ position:relative; overflow:hidden; border-radius:calc(var(--radius) * 1.2); border:1px solid var(--line); background: radial-gradient(120% 120% at 100% 0%, #1d2a4a 0%, #0c1220 55%, #0b0d12 100%); padding:1.25rem; margin-top:.5rem; }
    .hero h1{ margin:0 0 .25rem; font-size:clamp(1.35rem,6vw,1.75rem); line-height:1.25; letter-spacing:.02em; }
    .hero .lead{ color:#cfe1ff; margin:.25rem 0 .75rem; font-size:1rem }
    .cta{ display:flex; gap:.5rem; flex-wrap:wrap }
    .btn{ appearance:none; border:1px solid var(--accent-2-b); background:var(--accent-2); color:#fff; border-radius:.75rem; padding:.625rem .9rem; min-height:var(--tap); font-size:1rem; cursor:pointer }
    .btn:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }
    .btn.secondary{ background:#11172a; border-color:#2f3b63; color:#d7e6ff }
    .meta{ color:var(--muted); font-size:.85rem }

    /* Pills / tags */
    .pills{ display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.5rem }
    .pill{ display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--line); background:#11172a; color:#cfe1ff; border-radius:999px; padding:.25rem .6rem; font-size:.8rem }

    /* ===== Cards ===== */
    .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:var(--pad); margin:.75rem 0 }
    .label{ font-size:.95rem; color:#cfe1ff; margin-bottom:.5rem }

    /* Character row */
    .row{ display:flex; gap:.75rem; flex-wrap:wrap; }
    .char-btn{ appearance:none; background:none; border:1px solid var(--line); border-radius:.75rem; padding:.5rem; min-width:6rem; text-align:center; cursor:pointer }
    .char-btn img{ width:4.75rem; height:4.75rem; border-radius:50%; border:1px solid #2b3559; object-fit:cover }
    .char-btn div{ margin-top:.375rem; font-size:.875rem }

    /* Result box */
    .result{ border:1px dashed #32426b; border-radius:.75rem; padding:.75rem; background:#0f1526 }
    .stars{ letter-spacing:.12rem }
    .lock{ opacity:.65 }

    /* Feature grid */
    .grid{ display:grid; gap:.75rem; grid-template-columns:1fr 1fr; }
    @media (max-width:480px){ .grid{ grid-template-columns:1fr } }
    .tile{ text-decoration:none; color:inherit; border:1px solid var(--line); background:#10162a; border-radius:.75rem; padding:.75rem }
    .tile:hover{ background:#15203a }
    .tile .t1{ font-weight:700 }
    .tile .t2{ font-size:.86rem; color:#aeb7d0 }

    /* Social proof strip */
    .strip{ display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; justify-content:center; padding:.5rem; border:1px solid var(--line); border-radius:.75rem; background:#0f1528; font-size:.85rem }

    footer{ text-align:center; color:var(--muted); font-size:.75rem; margin:1.25rem 0 .5rem }

    /* Bottom nav (unchanged pattern) */
    .bottom-nav{ position:fixed; left:0; right:0; bottom:0; z-index:50; background:rgba(10,14,22,.9); backdrop-filter:blur(8px); border-top:1px solid var(--line) }
    .bn-grid{ max-width:40rem; margin:0 auto; display:grid; grid-template-columns:repeat(5,1fr) }
    .bn-btn{ appearance:none; background:none; border:0; color:#cfe1ff; text-decoration:none; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:.375rem 0; min-height:3.25rem; font-size:.75rem }
    .bn-icon{ width:20px; height:20px; margin-bottom:.125rem; border-radius:4px; border:1px solid var(--line); background:#16213c; display:flex; align-items:center; justify-content:center; font-size:.75rem }
    .bn-accent{ color:#fff }
  
  /* Calendar & Quote */
  #calendarQuote .pill{background:var(--accent-2);color:var(--accent);border:1px solid var(--accent-2-b)}
  #calendarQuote .pill:active{transform:translateY(1px)}

  /* Force the calendar to be independent from any parent reveal logic */
  
  
  #calendarQuote .skeleton{background:linear-gradient(90deg,rgba(255,255,255,.06),rgba(255,255,255,.12),rgba(255,255,255,.06));background-size:200% 100%;animation:sheen 1.6s infinite}
  @keyframes sheen{0%{background-position:200% 0}100%{background-position:-200% 0}}
</style>
</head>
<body>
  <div class="wrap">
    <!-- ===== HERO / Primary CTA ===== -->
    <section class="hero" aria-label="ä»Šæ—¥ã®å ã„">
      <h1>éŠ€ç«œã‹ã‚‰ã®ã“ã¨ã°ã‚’<br>ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§å—ã‘å–ã‚ã†</h1>
      <p class="lead">ç„¡æ–™ã§ã€Œç·åˆé‹ã€ã‚’å³è¡¨ç¤ºã€‚æœ‰æ–™ã§ <strong>9ã‚«ãƒ†ã‚´ãƒª</strong> ãŒæ¯æ—¥é–‹æ”¾ï¼ˆå¥åº·ãƒ»å¹³ç©ãƒ»ç”Ÿæ´»ãƒ»å¯¾äººãƒ»æˆé•·ãƒ»ç›®çš„ãƒ»è‡ªç”±ãƒ»å¨¯æ¥½ãƒ»è©•ä¾¡ï¼‰ã€‚</p>
      <div class="cta">
        <button id="ctaGet" class="btn" data-evt="cta_primary">ä»Šæ—¥ã®å ã„ã‚’å—ã‘å–ã‚‹</button>
        <a class="btn secondary" href="./signup.html" data-evt="cta_signup">ä¼šå“¡ç™»éŒ²ï¼ˆ1åˆ†ï¼‰</a>
      </div>
      <div class="pills" aria-hidden="true" style="margin-top:.75rem">
        <span class="pill">æ—¥æ›¿ã‚ã‚Šå›ºå®šãƒ­ã‚¸ãƒƒã‚¯</span>
        <span class="pill">ä¸–ç•Œè¦³ã«åˆã‚ã›ãŸè¨€è‘‰è¨­è¨ˆ</span>
        <span class="pill">è§£ç´„ã„ã¤ã§ã‚‚</span>
      </div>
    </section>

    <!-- ===== Quick character choose ===== -->
    <section class="card" aria-labelledby="chooseCharacter">
      <div id="chooseCharacter" class="label">èªã‚Šæ‰‹ã‚’é¸ã¶</div>
      <div class="row" id="charButtons">
        <button data-char="ãƒ«ãƒŠãƒ«" class="char-btn" aria-label="ãƒ«ãƒŠãƒ«" data-evt="char_pick"><img src="./assets/char-lunal.png" alt="ãƒ«ãƒŠãƒ«"><div>ãƒ«ãƒŠãƒ«</div></button>
        <button data-char="ã‚¢ãƒ©ãƒ³" class="char-btn" aria-label="ã‚¢ãƒ©ãƒ³" data-evt="char_pick"><img src="./assets/char-alan.png" alt="ã‚¢ãƒ©ãƒ³"><div>ã‚¢ãƒ©ãƒ³</div></button>
        <button data-char="ãƒªãƒªã‚¢" class="char-btn" aria-label="ãƒªãƒªã‚¢" data-evt="char_pick"><img src="./assets/char-lilia.png" alt="ãƒªãƒªã‚¢"><div>ãƒªãƒªã‚¢</div></button>
      </div>
      <p class="meta" style="text-align:center; margin-top:.5rem">é¸ã¶ãŸã³å½“æ—¥ã®çµæœã‚’è¡¨ç¤ºã€‚æ—¥ä»˜ãŒå¤‰ã‚ã‚‹ã¨æ›´æ–°ã€‚</p>
    </section>

    <!-- ===== Result ===== -->
    <section id="result" class="card" aria-live="polite" style="display:none">
      <div class="label">ä»Šæ—¥ã®çµæœ</div>
      <div class="result" id="resultBox">
        <!-- JS inject -->
      </div>
      <div class="pills" style="margin-top:.75rem">
        <a href="./zodiac.html" class="pill" data-evt="entry_zodiac">æ˜Ÿåº§åˆ¥è¨ºæ–­</a>
        <a href="./partner.html" class="pill" data-evt="entry_partner">ä»Šæ—¥ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</a>
        <a href="./serial.html" class="pill" data-evt="entry_serial">ä¸ƒå¤œã®èªã‚Šå·»</a>
      </div>
    
    <!-- ===== Calendar & Quote ===== -->
    <section id="calendarQuote" class="card" aria-live="polite">
      <div class="label">éŠ€ç«œæš¦ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
      <div class="cal-head" style="display:flex;align-items:center;gap:.5rem;justify-content:space-between;">
        <button class="pill" id="btnPrevDay" aria-label="å‰æ—¥ã¸">â† å‰æ—¥</button>
        <div class="cal-date" id="calDate" role="heading" aria-level="2" style="font-weight:700;letter-spacing:.02em;"></div>
        <button class="pill" id="btnNextDay" aria-label="ç¿Œæ—¥ã¸">ç¿Œæ—¥ â†’</button>
      </div>
      <div class="cal-sub" id="calHoliday" style="margin-top:.25rem;color:var(--muted)"></div>
      <div class="cal-quote" id="calQuote" style="margin-top:.75rem">
        <blockquote style="margin:0;font-size:1.05rem;line-height:1.6">
          <span id="quoteText" class="skeleton" style="display:inline-block;border-radius:.5rem;min-width:60%;min-height:1.2em"> </span>
        </blockquote>
        <div id="quoteAuthor" class="meta" style="margin-top:.375rem"><span class="skeleton" style="display:inline-block;border-radius:.5rem;min-width:8rem;min-height:1em"> </span></div>
      </div>
      <div class="pills" style="margin-top:.75rem;display:flex;gap:.5rem;flex-wrap:wrap">
        <button class="pill" id="btnToday" aria-label="ä»Šæ—¥ã¸æˆ»ã‚‹">ä»Šæ—¥</button>
      </div>
    </section>


    <!-- ===== Teasers / Content hubs ===== -->
    <section class="grid" aria-label="ç‰©èªã¨é£Ÿå“">
      <a href="./food.html" class="tile" data-evt="entry_food">
        <div class="t1">ç«œã®é£Ÿå“</div>
        <div class="t2">ç¾å®Ÿã«å†ç¾ã§ãã‚‹ç•°ç•Œã®ãƒ¬ã‚·ãƒ”ã€‚ä»Šæ—¥ã®ä¸€çš¿ã¨ã‚­ãƒ£ãƒ©åˆ¥ã®é£Ÿå“ã€‚</div>
      </a>
      <a href="./serial.html" class="tile" data-evt="entry_serial2">
        <div class="t1">ä¸ƒå¤œã®èªã‚Šå·»</div>
        <div class="t2">ç¶™æ‰¿è€…ãŸã¡ã®çŸ­ç·¨é€£ä½œã€‚ç„¡æ–™ã¯æŠœç²‹ã€æœ‰æ–™ã§å…¨æ–‡ã€‚</div>
      </a>
      <a href="./novel.html" class="tile" data-evt="entry_novel">
        <div class="t1">çŸ­ç·¨å°èª¬</div>
        <div class="t2">éŠ€ç«œä¸–ç•Œã®æŒç·¨ã€‚ã‚¹ã‚­ãƒæ™‚é–“ã§ã€‚</div>
      </a>
      <a href="./zodiac.html" class="tile" data-evt="entry_zodiac2">
        <div class="t1">æ˜Ÿåº§è¨ºæ–­</div>
        <div class="t2">12æ˜Ÿåº§Ã—9ã‚«ãƒ†ã‚´ãƒªã®è¦‹å–ã‚Šå›³ã€‚</div>
      </a>
    </section>

    <!-- ===== Social proof /å®‰å¿ƒææ–™ ===== -->
    <section class="strip" aria-label="æ¡ˆå†…">
      <span>åºƒå‘Šãªã—</span>
      <span>å€‹äººæƒ…å ±ã¯æœ€å°é™</span>
      <span>è§£ç´„ã¯ãƒã‚¤ãƒšãƒ¼ã‚¸ã§å³æ™‚</span>
      <span>ã‚­ãƒ£ãƒªã‚¢æ±ºæ¸ˆå¯¾å¿œ</span>
    </section>

    <footer>Â© é‹å‘½ã®éŠ€ç«œæš¦</footer>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav" aria-label="ä¸»è¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
    <div class="bn-grid">
      <a class="bn-btn bn-accent" href="./index.html" aria-current="page"><span class="bn-icon">å </span><span>å ã„</span></a>
      <a class="bn-btn" href="./list.html"><span class="bn-icon">ãŠ</span><span>ãŠã¾ã‘</span></a>
      <a class="bn-btn" href="./serial.html"><span class="bn-icon">å·»</span><span>èªã‚Šå·»</span></a>
      <a class="bn-btn" href="./food.html"><span class="bn-icon">é£Ÿ</span><span>é£Ÿå“</span></a>
      <a class="bn-btn" href="./signup.html"><span class="bn-icon">ä¼š</span><span>ä¼šå“¡</span></a>
    </div>
  </nav>

<script>
// ===== Config / Constants =====
const JSON_PATH = "./fortune_messages.json";
const FALLBACK = {
  meta:{version:2, characters:["ãƒ«ãƒŠãƒ«","ã‚¢ãƒ©ãƒ³","ãƒªãƒªã‚¢"], free_categories:["ç·åˆ"]},
  weights:{"5":18,"4":32,"3":30,"2":15,"1":5},
  categories:[
    {key:"ç·åˆ",paid:false},{key:"å¥åº·",paid:true},{key:"å¹³ç©",paid:true},{key:"ç”Ÿæ´»",paid:true},
    {key:"å¯¾äºº",paid:true},{key:"æˆé•·",paid:true},{key:"ç›®çš„",paid:true},{key:"è‡ªç”±",paid:true},
    {key:"å¨¯æ¥½",paid:true},{key:"è©•ä¾¡",paid:true}
  ],
  messages:{
    "ç·åˆ":{
      "5":{ "ãƒ«ãƒŠãƒ«":"ä»Šæ—¥ã¯è¿½ã„é¢¨ã ã€‚é æ…®ãªãè¡Œã“ã†ã€‚","ã‚¢ãƒ©ãƒ³":"æ€ã£ãŸä»¥ä¸Šã«é€²ã‚€æ—¥ã€‚ç´ ç›´ã«è¸ã¿å‡ºãã†ã€‚","ãƒªãƒªã‚¢":"å…‰ãŒã‚ãªãŸã‚’åŒ…ã‚€æ—¥ã€‚å°ã•ãªå¥‡è·¡ã‚’æ‹¾ã£ã¦ã€‚" },
      "4":{ "ãƒ«ãƒŠãƒ«":"æ•´ã£ã¦ã„ã‚‹ã€‚ã„ã¤ã‚‚ã‚ˆã‚Šä¸€æ­©æ·±ãã€‚","ã‚¢ãƒ©ãƒ³":"æµã‚Œã¯è‰¯å¥½ã€‚æ®µå–ã‚Šã‚’æ„è­˜ã™ã‚‹ã¨å‰ã€‚","ãƒªãƒªã‚¢":"æ¾„ã‚“ã ç©ºæ°—ã€‚è¿·ã£ãŸã‚‰è»½ã„æ–¹ã‚’ã€‚" },
      "3":{ "ãƒ«ãƒŠãƒ«":"å¹³å¸¸é‹ã€‚è¶³å ´ã‚’å›ºã‚ã¦ãŠã‘ã€‚","ã‚¢ãƒ©ãƒ³":"å¯ã‚‚ãªãä¸å¯ã‚‚ãªãã€‚åŸºæœ¬ã‚’ä¸å¯§ã«ã€‚","ãƒªãƒªã‚¢":"é™ã‹ãªæ—¥ã€‚ç„¡ç†ã›ãšæ•´ãˆã¦ã€‚" },
      "2":{ "ãƒ«ãƒŠãƒ«":"ç„¦ã‚Šã¯ä¸è¦ã€‚ä»Šæ—¥ã¯å®ˆã‚Šã‚’å„ªå…ˆã€‚","ã‚¢ãƒ©ãƒ³":"ç„¡ç†ã¯ç¦ç‰©ã€‚å°ç›®æ¨™ã§ååˆ†ã€‚","ãƒªãƒªã‚¢":"ä¼‘ã‚€å‹‡æ°—ã‚’ã€‚å¿ƒã«ä½™ç™½ã‚’ã€‚" },
      "1":{ "ãƒ«ãƒŠãƒ«":"é€€ãã‚‚å‹‡ã€‚æ˜æ—¥ã«åŠ›ã‚’æ®‹ã›ã€‚","ã‚¢ãƒ©ãƒ³":"ä»Šæ—¥ã¯å°ä¼‘æ­¢ã€‚æœ€ä½é™ã§OKã€‚","ãƒªãƒªã‚¢":"ã‚„ã•ã—ãéã”ã—ã¦ã€‚è‡ªåˆ†ã‚’è²¬ã‚ãªã„ã§ã€‚" }
    }
  }
};

let META=null, MESSAGES=null, WEIGHTS=null, CATEGORIES=null, CHARACTERS=null, FREE_KEYS=new Set(["ç·åˆ"]), isPremium=false;

// ===== Utils =====
function $(sel, el=document){ return el.querySelector(sel); }
function esc(s){ return String(s||"").replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m])); }
function hashStr(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^(t>>>15),t|1); t^=t+Math.imul(t^(t>>>7),t|61); return ((t^(t>>>14))>>>0)/4294967296; } }
function todayKey(){ const d=new Date(); return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; }
function starText(n){ return "â˜…â˜…â˜…â˜…â˜…â˜†â˜†â˜†â˜†â˜†".slice(5-n,10-n); }
function pickByWeights(weights, seed){ const rng=mulberry32(hashStr(seed)); const entries=Object.entries(weights); const total=entries.reduce((s,[,w])=>s+Number(w),0); let r=rng()*total; for(const [star,w] of entries){ if(r<w) return Number(star); r-=w; } return 3; }

// Tiny analytics hooks (GA4é€£æºã®ç½®ãæ›ãˆæƒ³å®š)
function track(name, detail){ document.dispatchEvent(new CustomEvent('track', {detail:{name, ...detail}})); }

// ===== Render Result =====
function renderResult(char){
  const res = $('#result');
  const box = $('#resultBox');
  res.style.display = 'block';

  const seed = `${todayKey()}|${char}|ç·åˆ`;
  const stars = pickByWeights(WEIGHTS, seed);
  const msg = (MESSAGES?.["ç·åˆ"]?.[String(stars)]?.[char]) || 'ä»Šæ—¥ã®è¨€è‘‰ã¯æº–å‚™ä¸­ã§ã™ã€‚';

  const premiumList = CATEGORIES.filter(c=>c.paid);
  const paidHtml = premiumList.map(c=>`<li class="lock">${esc(c.key)}ï¼š<span aria-hidden="true">ğŸ”’</span> æœ‰æ–™ã§é–‹æ”¾</li>`).join('');

  box.innerHTML = `
    <div style="display:flex; gap:.75rem; align-items:center; margin-bottom:.25rem">
      <div style="width:2.75rem; height:2.75rem; border-radius:50%; border:1px solid #2b3559; background:#10162a; display:flex; align-items:center; justify-content:center">${esc(char.slice(0,2))}</div>
      <div>
        <div class="stars" aria-label="é‹å‹¢">${starText(stars)}</div>
        <div style="color:#e8eeff; font-size:1rem; margin-top:.125rem">${esc(msg)}</div>
      </div>
    </div>
    <hr style="border:none; border-top:1px solid var(--line); margin:.75rem 0" />
    <div class="meta">ç„¡æ–™ä¼šå“¡ï¼šç·åˆã®ã¿è¡¨ç¤º / æœ‰æ–™ä¼šå“¡ï¼š9ã‚«ãƒ†ã‚´ãƒªãŒæ¯æ—¥é–‹æ”¾</div>
    <ul style="margin:.25rem 0 0 .9rem; padding:0">${paidHtml}</ul>
    <div style="margin-top:.75rem; display:flex; gap:.5rem; flex-wrap:wrap">
      <a href="./signup.html" class="btn" data-evt="upsell">æœ‰æ–™ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹</a>
      <a href="./zodiac.html" class="btn secondary" data-evt="zodiac_after">æ˜Ÿåº§è¨ºæ–­ã¸</a>
    </div>
  `;
}

// ===== Init JSON =====
function initWithJson(json){
  META=json.meta||{}; WEIGHTS=json.weights||FALLBACK.weights; MESSAGES=json.messages||FALLBACK.messages; CATEGORIES=json.categories||FALLBACK.categories; CHARACTERS= (json.meta?.characters)||FALLBACK.meta.characters; if(Array.isArray(json.meta?.free_categories)) FREE_KEYS=new Set(json.meta.free_categories);
}

fetch(JSON_PATH).then(r=>r.ok?r.json():Promise.reject('fetch not ok')).then(initWithJson).catch(()=>initWithJson(FALLBACK));

// ===== Events =====
$('#ctaGet').addEventListener('click', ()=>{ track('cta_primary',{}); const first = CHARACTERS?.[0]||'ãƒ«ãƒŠãƒ«'; renderResult(first); window.scrollTo({top:$('#result').offsetTop - 12, behavior:'smooth'}); });
$('#charButtons').addEventListener('click', (e)=>{ const btn = e.target.closest('[data-char]'); if(!btn) return; const c = btn.getAttribute('data-char'); track('char_pick',{char:c}); renderResult(c); window.scrollTo({top:$('#result').offsetTop - 12, behavior:'smooth'}); });

</script>

<script>
(function(){
  // ===== Date helpers =====
  const pad = n => String(n).padStart(2,'0');
  const fmtJP = d => {
    const y=d.getFullYear(), m=d.getMonth()+1, da=d.getDate();
    const w = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][d.getDay()];
    return `${y}å¹´${m}æœˆ${da}æ—¥ï¼ˆ${w}ï¼‰`;
  };
  const keyMMDD = d => `${pad(d.getMonth()+1)}-${pad(d.getDate())}`;

  // ===== Japanese Holidays (basic, with substitute if Sunday) =====
  function vernalEquinoxDay(year){
    // Approximation valid around 2000-2099
    return Math.floor(20.8431 + 0.242194*(year-1980)) - Math.floor((year-1980)/4);
  }
  function autumnalEquinoxDay(year){
    return Math.floor(23.2488 + 0.242194*(year-1980)) - Math.floor((year-1980)/4);
  }
  function nthWeekdayOfMonth(year, month, weekday, nth){
    // month: 1-12, weekday: 0=Sun..6=Sat
    const first = new Date(year, month-1, 1);
    const add = (weekday - first.getDay() + 7) % 7;
    const day = 1 + add + 7*(nth-1);
    return day;
  }
  function japaneseHoliday(date){
    const y = date.getFullYear();
    const m = date.getMonth()+1;
    const d = date.getDate();
    const wd = date.getDay();

    let name = null;
    // Fixed
    if (m===1 && d===1) name = 'å…ƒæ—¥';
    else if (m===2 && d===11) name = 'å»ºå›½è¨˜å¿µã®æ—¥';
    else if (m===2 && d===23) name = 'å¤©çš‡èª•ç”Ÿæ—¥';
    else if (m===4 && d===29) name = 'æ˜­å’Œã®æ—¥';
    else if (m===5 && d===3) name = 'æ†²æ³•è¨˜å¿µæ—¥';
    else if (m===5 && d===4) name = 'ã¿ã©ã‚Šã®æ—¥';
    else if (m===5 && d===5) name = 'ã“ã©ã‚‚ã®æ—¥';
    else if (m===8 && d===11) name = 'å±±ã®æ—¥';
    else if (m===11 && d===3) name = 'æ–‡åŒ–ã®æ—¥';
    else if (m===11 && d===23) name = 'å‹¤åŠ´æ„Ÿè¬ã®æ—¥';

    // Happy Monday
    if (!name){
      if (m===1 && d===nthWeekdayOfMonth(y,1,1,2)) name = 'æˆäººã®æ—¥';          // 1æœˆç¬¬2æœˆæ›œ
      else if (m===7 && d===nthWeekdayOfMonth(y,7,1,3)) name = 'æµ·ã®æ—¥';      // 7æœˆç¬¬3æœˆæ›œ
      else if (m===9 && d===nthWeekdayOfMonth(y,9,1,3)) name = 'æ•¬è€ã®æ—¥';    // 9æœˆç¬¬3æœˆæ›œ
      else if (m===10 && d===nthWeekdayOfMonth(y,10,1,2)) name = 'ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥'; // 10æœˆç¬¬2æœˆæ›œ
    }

    // Equinox
    if (!name && m===3 && d===vernalEquinoxDay(y)) name = 'æ˜¥åˆ†ã®æ—¥';
    if (!name && m===9 && d===autumnalEquinoxDay(y)) name = 'ç§‹åˆ†ã®æ—¥';

    // Substitute holiday (Sun -> Mon/Tue... first weekday after)
    if (!name){
      const yesterday = new Date(y, m-1, d-1);
      if (yesterday.getDay() === 0){ // yesterday was Sunday
        // check if yesterday was a holiday
        if (japaneseHolidayCore(yesterday)) name = 'æŒ¯æ›¿ä¼‘æ—¥';
      }
    }
    function japaneseHolidayCore(dt){
      // core without substitute
      const yy=dt.getFullYear(), mm=dt.getMonth()+1, dd=dt.getDate();
      if (mm===1 && dd===1) return true;
      if (mm===2 && dd===11) return true;
      if (mm===2 && dd===23) return true;
      if (mm===4 && dd===29) return true;
      if (mm===5 && dd===3) return true;
      if (mm===5 && dd===4) return true;
      if (mm===5 && dd===5) return true;
      if (mm===8 && dd===11) return true;
      if (mm===11 && dd===3) return true;
      if (mm===11 && dd===23) return true;
      if (mm===1 && dd===nthWeekdayOfMonth(yy,1,1,2)) return true;
      if (mm===7 && dd===nthWeekdayOfMonth(yy,7,1,3)) return true;
      if (mm===9 && dd===nthWeekdayOfMonth(yy,9,1,3)) return true;
      if (mm===10 && dd===nthWeekdayOfMonth(yy,10,1,2)) return true;
      if (mm===3 && dd===vernalEquinoxDay(yy)) return true;
      if (mm===9 && dd===autumnalEquinoxDay(yy)) return true;
      return false;
    }
    return name;
  }

  // ===== State =====
  const elDate = document.getElementById('calDate');
  const elHoliday = document.getElementById('calHoliday');
  const elQuoteText = document.getElementById('quoteText');
  const elQuoteAuthor = document.getElementById('quoteAuthor');
  const $section = document.getElementById('calendarQuote');
  const btnPrev = document.getElementById('btnPrevDay');
  const btnNext = document.getElementById('btnNextDay');
  const btnToday = document.getElementById('btnToday');

  let quotes = null;
  let current = new Date();

  // === Load quotes.json ===
  render();
  fetch('./quotes.json', {cache:'no-store'})
    .then(r=>r.json()).then(data=>{ quotes = data; render(); })
    .catch(()=>{ quotes = {"01-01":[{"text":"ï¼ˆåè¨€ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼‰","author":"éŠ€ç«œéŒ²"}]}; render(); });

  function render(){
    const key = keyMMDD(current);
    const list = (quotes && (quotes[key] || quotes[key.toLowerCase()] || quotes[key.replace(/^0/,'').replace('-0','-')])) || [];
    const item = list[0] || {text:"ã“ã®æ—¥ã¯é™ç©ã€‚ç«œã¯ãŸã ç¿¼ã‚’ä¼‘ã‚ã‚‹ã€‚", author:"éŠ€ç«œéŒ²"};
    elDate.textContent = fmtJP(current);
    const holi = japaneseHoliday(current);
    elHoliday.textContent = holi ? `ç¥æ—¥ï¼š${holi}` : '';
    elQuoteText.classList.remove('skeleton'); elQuoteText.textContent = item.text;
    elQuoteAuthor.innerHTML = `â€” ${item.author}`;
  }

  // === Nav ===
  btnPrev.addEventListener('click', ()=>{ current.setDate(current.getDate()-1); render(); });
  btnNext.addEventListener('click', ()=>{ current.setDate(current.getDate()+1); render(); });
  btnToday.addEventListener('click', ()=>{ current = new Date(); render(); });

  // === Swipe ===
  let x0=null, y0=null;
  $section.addEventListener('touchstart', (e)=>{
    const t=e.touches[0]; x0=t.clientX; y0=t.clientY;
  }, {passive:true});
  $section.addEventListener('touchend', (e)=>{
    if(x0===null) return;
    const t=e.changedTouches[0];
    const dx=t.clientX-x0, dy=t.clientY-y0;
    if(Math.abs(dx)>40 && Math.abs(dx)>Math.abs(dy)){
      if(dx<0) { current.setDate(current.getDate()+1); } else { current.setDate(current.getDate()-1); }
      render();
    }
    x0=y0=null;
  });
})();
</script>

</body>
</html>
