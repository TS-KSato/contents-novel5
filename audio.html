<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>竜歌の視聴｜運命の銀竜暦</title>
  <meta name="description" content="銀竜世界の竜歌を再生" />
  <style>
    :root { --bg:#0d0f14; --card:#151922; --text:#e7ecf3; --muted:#9aa3b2; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    header{display:flex;align-items:center;gap:10px;padding:14px}
    .back{color:#cfe1ff;text-decoration:none;font-weight:700}
    .wrap{padding:12px}
    .art{width:100%;aspect-ratio:1/1;border-radius:16px;background:linear-gradient(135deg,#2b3446,#3c5076);display:grid;place-items:center;font-size:28px}
    .title{font-weight:800;font-size:20px;margin-top:14px}
    .sub{color:var(--muted);font-size:13px;margin-top:4px}
    .player{margin-top:14px;background:var(--card);border:1px solid #212836;border-radius:16px;padding:12px}
    .row{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;border:0;background:#3b6bd9;color:white;padding:10px 12px;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer}
    .ghost{background:#1f2937;color:#cfe1ff;border:1px solid #2a3446}
    .range{accent-color:#6aa8ff;width:100%}
    .note{margin-top:14px;color:#c8d4e8;font-size:14px;line-height:1.6}
    nav.bottom{position:fixed;left:0;right:0;bottom:0;background:#0f131b;border-top:1px solid #232a39;display:grid;grid-template-columns:repeat(3,1fr)}
    nav.bottom a{display:grid;place-items:center;padding:12px 6px;color:#b9c4d6;text-decoration:none;font-size:12px}
  </style>
</head>
<body>
  <header>
    <a class="back" id="back" href="music.html">← 一覧へ</a>
  </header>
  <main class="wrap">
    <div class="art" id="art" aria-hidden="true">♪</div>
    <div class="title" id="title">竜歌：星海を渡る翼</div>
    <div class="sub" id="meta">Wind Guide ／ 96 BPM ／ 3:00</div>

    <section class="player">
      <audio id="audio" preload="metadata"></audio>
      <div class="row" style="justify-content:space-between; margin-bottom:8px;">
        <button class="btn" id="play" type="button">再生</button>
        <button class="btn ghost" id="loop" type="button">ループOFF</button>
        <button class="btn ghost" id="sleep" type="button">就寝タイマー</button>
      </div>
      <input class="range" type="range" id="seek" min="0" max="100" value="0" />
    </section>

    <p class="note">銀竜の記憶から紡がれた旋律の断片です。完全な形ではありませんが、瞑想や休息の補助としてお使いください。</p>
  </main>

  <nav class="bottom">
    <a href="index.html">ホーム</a>
    <a href="notice.html">お知らせ</a>
    <a href="mypage.html">マイページ</a>
  </nav>

<script>
// 最小実装：クエリ ?id=t01..t06 に応じて1曲選択（無指定は t01）
const TRACKS = {
  t01:{ name:"竜歌：星海を渡る翼", mood:"focus", bpm:96, duration:180, role:"Wind Guide", url:"https://www.w3schools.com/html/horse.mp3" },
  t02:{ name:"竜歌：灰青の祈雨", mood:"ritual", bpm:72, duration:220, role:"Healer", url:"https://www.w3schools.com/html/horse.mp3" },
  t03:{ name:"竜歌：山影の火床", mood:"focus", bpm:120, duration:200, role:"Knight", url:"https://www.w3schools.com/html/horse.mp3" },
  t04:{ name:"竜歌：灯る鱗紋", mood:"rest", bpm:88, duration:160, role:"Lorekeeper", url:"https://www.w3schools.com/html/horse.mp3" },
  t05:{ name:"竜歌：眠りの風域", mood:"sleep", bpm:60, duration:600, role:"Disciple", url:"https://www.w3schools.com/html/horse.mp3" },
  t06:{ name:"竜歌：潮鳴りの記憶", mood:"rest", bpm:78, duration:190, role:"Stormblade", url:"https://www.w3schools.com/html/horse.mp3" }
};

const qs = new URLSearchParams(location.search);
const id = qs.get('id') || 't01';
const from = qs.get('from');
if(from) document.getElementById('back').href = from+".html";

const data = TRACKS[id] || TRACKS.t01;
document.getElementById('title').textContent = data.name;
document.getElementById('meta').textContent = `${data.role} ／ ${data.bpm} BPM`;

const audio = document.getElementById('audio');
const seek = document.getElementById('seek');
audio.src = data.url;

const playBtn = document.getElementById('play');
const loopBtn = document.getElementById('loop');
const sleepBtn = document.getElementById('sleep');

let timer = null;
playBtn.addEventListener('click', ()=>{
  if(audio.paused){ audio.play(); playBtn.textContent='一時停止'; } else { audio.pause(); playBtn.textContent='再生'; }
});
loopBtn.addEventListener('click', ()=>{
  audio.loop = !audio.loop; loopBtn.textContent = audio.loop ? 'ループON' : 'ループOFF';
});
sleepBtn.addEventListener('click', ()=>{
  if(timer){ clearTimeout(timer); timer=null; sleepBtn.textContent='就寝タイマー'; return; }
  timer = setTimeout(()=>{ audio.pause(); playBtn.textContent='再生'; timer=null; }, 15*60*1000);
  sleepBtn.textContent='15分後に停止';
});
audio.addEventListener('timeupdate',()=>{
  if(!isFinite(audio.duration)) return;
  seek.value = Math.floor(100 * (audio.currentTime / audio.duration));
});
seek.addEventListener('input',()=>{
  if(!isFinite(audio.duration)) return;
  audio.currentTime = (seek.value/100) * audio.duration;
});
</script>
</body>
</html>
