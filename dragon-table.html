<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>é‹å‘½ã®éŠ€ç«œæš¦ï½œç«œã®é£Ÿå“</title>
  <meta name="description" content="ã‚¨ãƒ†ãƒ«ãƒŠãƒªã‚¢ã®äººã€…ãŒå£ã«ã™ã‚‹ç´ æœ´ãªæ–™ç†ã‚’ã€äººé–“ç•Œã®é£Ÿæã§å†ç¾ã—ãŸè¨˜éŒ²ã€‚ä»Šæ—¥ã®ä¸€å“ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥ã®é£Ÿå“ã€‚">
  <style>
    html { font-size: 16px; }
    :root{
      --bg:#0b0d12; --ink:#ffffff; --muted:#aeb7d0; --line:#27304a; --card:#151826;
      --accent:#9fd3ff; --accent-2:#1a3358; --accent-2-b:#34507c;
      --radius:.875rem; --pad:1rem; --gap:.75rem; --tap:2.75rem;
    }
    *{ box-sizing:border-box }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
      line-height:1.8; font-size:1rem; -webkit-text-size-adjust:100%;
      text-rendering: optimizeLegibility;
      padding-bottom:4.5rem; /* ä¸‹éƒ¨ãƒŠãƒ“åˆ†ã®ä½™ç™½ */
    }
    .wrap{ max-width:40rem; margin:0 auto; padding:1.0rem 1.0rem 0; }

    header{ text-align:center; padding:.5rem .25rem .5rem; }
    header h1{ margin:.25rem 0 .25rem; font-size:clamp(1.15rem,5vw,1.5rem); font-weight:700; }
    header .muted{ color:var(--muted); font-size:.875rem; margin:0; }

    .card{ background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:var(--pad); margin:.75rem 0; }
    .label{ font-size:.9375rem; color:#cfe1ff; margin-bottom:.5rem }
    .title{ font-size:1.125rem; font-weight:700; line-height:1.4; margin:.25rem 0 .25rem; }
    .meta{ color:var(--muted); font-size:.8125rem; }
    .lead{ color:#e8eeff; font-size:1rem; margin:.25rem 0 .5rem; }
    .body{ color:#e0e6ff; font-size:1rem; }
    .sep{ height:1px; background:var(--line); margin:.75rem 0; }

    .article-head{
      display:grid; grid-template-columns:auto 1fr; gap:.75rem; align-items:center; margin-bottom:.5rem;
    }
    .avatar{
      width:3.25rem; height:3.25rem; border-radius:50%; border:1px solid var(--line);
      background:#10172a center/cover no-repeat; display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#cfe1ff; flex-shrink:0;
    }
    .avatar.fallback{ background:#10172a; }

    .list{ display:grid; gap:.75rem; }
    .item{
      display:grid; grid-template-columns:auto 1fr auto; gap:.75rem; align-items:center;
      background:#11172a; border:1px solid var(--line); border-radius:.75rem; padding:.5rem .625rem;
      text-decoration:none; color:inherit;
    }
    .item:hover{ background:#16203a }
    .item .name{ font-size:1rem; font-weight:700; }
    .item .sub{ font-size:.8125rem; color:var(--muted); }

    .pill{
      display:inline-flex; align-items:center; justify-content:center; color:#d7e6ff;
      background:#13203a; border:1px solid #2b3b61; border-radius:999px; padding:.25rem .5rem; font-size:.75rem;
      text-decoration:none;
    }

    /* ä¸‹éƒ¨å›ºå®šãƒŠãƒ“ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰ */
    .bottom-nav{
      position:fixed; left:0; right:0; bottom:0; z-index:50;
      background:rgba(10,14,22,.9); backdrop-filter:blur(8px);
      border-top:1px solid var(--line);
    }
    .bn-grid{ max-width:40rem; margin:0 auto; display:grid; grid-template-columns:repeat(3,1fr); }
    .bn-btn{
      appearance:none; background:none; border:0; color:#cfe1ff; text-decoration:none;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      padding:.375rem 0; min-height:3.25rem; font-size:.75rem;
    }
    .bn-btn:focus-visible{ outline:2px solid var(--accent); outline-offset:-2px; }
    .bn-icon{
      width:20px; height:20px; margin-bottom:.125rem; border-radius:4px; border:1px solid var(--line); background:#16213c;
      display:flex; align-items:center; justify-content:center; font-size:.75rem;
    }
    .bn-accent{ color:#fff; }

    footer{ text-align:center; color:var(--muted); font-size:.75rem; margin:1rem 0 .75rem }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ç«œã®é£Ÿå“</h1>
      <p class="muted">å†ç¾ã¯æ˜“ã—ãã€ç‰©èªã¯æ·±ãã€‚ã‚¨ãƒ†ãƒ«ãƒŠãƒªã‚¢ã®é£Ÿå“ã‹ã‚‰ä¸€çš¿ã€‚</p>
    </header>

    <!-- ä»Šæ—¥ã®ä¸€å“ -->
    <section class="card" aria-label="ä»Šæ—¥ã®ä¸€å“">
      <div class="label">ä»Šæ—¥ã®ä¸€å“</div>
      <div id="todayDish"></div>
      <p class="meta" style="margin-top:.5rem;">â€» æ—¥ä»˜ã«ã‚‚ã¨ã¥ã„ã¦æ¯æ—¥å›ºå®šã®ä¸€çš¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </section>

    <!-- ã‚­ãƒ£ãƒ©åˆ¥å°ç·š -->
    <section class="card" aria-label="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®é£Ÿå“">
      <div class="label">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®é£Ÿå“</div>
      <div id="charLinks" class="list">
        <!-- JSã§ãƒªãƒ³ã‚¯ç”Ÿæˆï¼ˆã‚¢ãƒ©ãƒ³ï¼ãƒ‰ãƒ¬ã‚¤ã‚¯ï¼ãƒ©ã‚¤ãƒ©ï¼ãƒã‚¹ã‚¿ãƒ¼ï¼‰ -->
      </div>
    </section>

    <footer>Â© é‹å‘½ã®éŠ€ç«œæš¦</footer>
  </div>

  <!-- ä¸‹éƒ¨å›ºå®šãƒŠãƒ“ -->
  <nav class="bottom-nav" aria-label="ä¸»è¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
    <div class="bn-grid">
      <a class="bn-btn" href="./index.html" aria-label="ãƒ›ãƒ¼ãƒ ">
        <span class="bn-icon">ğŸ </span><span>ãƒ›ãƒ¼ãƒ </span>
      </a>
      <a class="bn-btn" href="./notice.html" aria-label="ãŠçŸ¥ã‚‰ã›">
        <span class="bn-icon">ğŸ“£</span><span>ãŠçŸ¥ã‚‰ã›</span>
      </a>
      <a class="bn-btn" href="./mypage.html" aria-label="ãƒã‚¤ãƒšãƒ¼ã‚¸">
        <span class="bn-icon">ğŸ‘¤</span><span>ãƒã‚¤ãƒšãƒ¼ã‚¸</span>
      </a>
    </div>
  </nav>

<script>
const JSON_PATH = "./recipe.json";

/* ---------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
function esc(s){ 
  return String(s||"").replace(/[&<>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]));
}
function todaySeed(){
  const d = new Date();
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç«¯æœ«æ—¥ä»˜ã«åŸºã¥ãæ—¥æ›¿ã‚ã‚Šå›ºå®š
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}
function hashStr(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^(t>>>15),t|1); t^=t+Math.imul(t^(t>>>7),t|61); return ((t^(t>>>14))>>>0)/4294967296; } }
function pickOneDet(arr, seedStr){
  if(!arr.length) return null;
  const rng = mulberry32(hashStr(seedStr));
  const idx = Math.floor(rng()*arr.length);
  return arr[idx];
}

/* ---------- ã€Œä»Šæ—¥ã®ä¸€å“ã€æç”» ---------- */
const todayEl = document.getElementById("todayDish");

function renderToday(dish){
  if(!dish){
    todayEl.innerHTML = `<div class="meta">æ–™ç†ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å¾Œã»ã©å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>`;
    return;
  }
  const initials = (dish.character||"").slice(0,2) || "é£Ÿ";
  const avatar = dish.avatar ? `<div class="avatar" style="background-image:url('${esc(dish.avatar)}');" aria-hidden="true"></div>`
                             : `<div class="avatar fallback" aria-hidden="true">${esc(initials)}</div>`;

  todayEl.innerHTML = `
    <div class="article-head">
      ${avatar}
      <div>
        <div class="title">${esc(dish.title)}</div>
        <div class="meta">${esc(dish.real_name||"")}${dish.character?` / èªã‚Šæ‰‹ï¼š${esc(dish.character)}`:""}</div>
      </div>
    </div>
    ${ dish.intro ? `<p class="lead">${esc(dish.intro)}</p>` : "" }
    <div class="sep"></div>
    <div class="body">
      <h3 style="margin:.25rem 0 .25rem; font-size:1rem;">ææ–™</h3>
      <ul style="margin:.25rem 0 .5rem; padding-left:1.25rem;">
        ${(dish.ingredients||[]).map(i=>`<li>${esc(i)}</li>`).join("")}
      </ul>
      <h3 style="margin:.25rem 0 .25rem; font-size:1rem;">ä½œã‚Šæ–¹</h3>
      <ol style="margin:.25rem 0 .5rem; padding-left:1.25rem;">
        ${(dish.steps||[]).map(s=>`<li>${esc(s)}</li>`).join("")}
      </ol>
    </div>
    ${ dish.comment ? `<div class="sep"></div><p class="meta">${esc(dish.comment)}</p>` : "" }
  `;
}

/* ---------- ã‚­ãƒ£ãƒ©åˆ¥å°ç·š ---------- */
const charEl = document.getElementById("charLinks");
const CHAR_ORDER = ["ã‚¢ãƒ©ãƒ³","ãƒ‰ãƒ¬ã‚¤ã‚¯","ãƒ©ã‚¤ãƒ©","ãƒã‚¹ã‚¿ãƒ¼"];
const CHAR_LINK = {
  "ã‚¢ãƒ©ãƒ³":"./dragon-table-alan.html",
  "ãƒ‰ãƒ¬ã‚¤ã‚¯":"./dragon-table-drake.html",
  "ãƒ©ã‚¤ãƒ©":"./dragon-table-laila.html",
  "ãƒã‚¹ã‚¿ãƒ¼":"./dragon-table-nester.html"
};

function renderCharLinks(recipes){
  const byChar = {};
  recipes.forEach(r => {
    const c = r.character || "ãã®ä»–";
    (byChar[c] ||= []).push(r);
  });

  const itemsHtml = CHAR_ORDER.map(c=>{
    const arr = byChar[c]||[];
    const initials = c.slice(0,2);
    // ä»£è¡¨ã‚¢ãƒã‚¿ãƒ¼ï¼ˆæœ€åˆã®ã‚¢ã‚¤ãƒ†ãƒ ã®avatarãŒã‚ã‚Œã°æ¡ç”¨ï¼‰
    const av = (arr.find(x=>x.avatar)||{}).avatar || "";
    const avatar = av
      ? `<div class="avatar" style="width:2.5rem;height:2.5rem;background-image:url('${esc(av)}');" aria-hidden="true"></div>`
      : `<div class="avatar fallback" style="width:2.5rem;height:2.5rem;" aria-hidden="true">${esc(initials)}</div>`;

    // å…ˆé ­2ä»¶ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    const preview = arr.slice(0,2).map(x=>x.title).join("ãƒ»");
    const link = CHAR_LINK[c] || "#";

    return `
      <a class="item" href="${esc(link)}" aria-label="${esc(c)}ã®é£Ÿå“ã¸">
        ${avatar}
        <div>
          <div class="name">${esc(c)}ã®é£Ÿå“</div>
          <div class="sub">${arr.length}å“ / ${esc(preview || "æº–å‚™ä¸­")}</div>
        </div>
        <span class="pill">è¦‹ã‚‹ â†’</span>
      </a>
    `;
  }).join("");

  charEl.innerHTML = itemsHtml;
}

/* ---------- èµ·å‹• ---------- */
(async function init(){
  try{
    const res = await fetch(JSON_PATH, {cache:"no-cache"});
    if(!res.ok) throw new Error("fetch failed");
    const data = await res.json();

    // æƒ³å®šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼šé…åˆ—
    const recipes = Array.isArray(data) ? data : (Array.isArray(data.items) ? data.items : []);
    if(!recipes.length){ throw new Error("no recipes"); }

    // ä»Šæ—¥ã®ä¸€å“ï¼ˆåŒæ—¥å›ºå®šã‚·ãƒ¼ãƒ‰ï¼‰
    const dish = pickOneDet(recipes, "food|"+todaySeed());
    renderToday(dish);

    // ã‚­ãƒ£ãƒ©åˆ¥å°ç·š
    renderCharLinks(recipes);

  }catch(e){
    console.warn("recipe.jsonèª­ã¿è¾¼ã¿å¤±æ•—:", e);
    todayEl.innerHTML = `<div class="meta">ãƒ¬ã‚·ãƒ”ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>recipe.json ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</div>`;
    charEl.innerHTML = `
      <div class="meta">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥ã®é£Ÿå“ã¯ã€ãƒ‡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã‚æ¬¡ç¬¬è¡¨ç¤ºã—ã¾ã™ã€‚</div>
    `;
  }
})();
</script>
</body>
</html>
