<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>エテルナリア音楽館｜運命の銀竜暦</title>
  <meta name="description" content="エテルナリア大陸の音楽を気分で探す" />
  <style>
    :root { --bg:#0d0f14; --card:#151922; --text:#e7ecf3; --muted:#9aa3b2; --acc:#6aa8ff; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;background:linear-gradient(180deg,#0d0f14 70%,#0d0f1400);padding:14px 16px 8px;z-index:10}
    .title{font-weight:700;font-size:18px}
    .tabs{display:flex;gap:8px;margin-top:10px;overflow:auto;padding-bottom:6px}
    .tab{padding:8px 12px;border-radius:999px;background:#1b2230;color:#cfe1ff;font-size:13px;white-space:nowrap;cursor:pointer;border:1px solid #273144}
    .tab.active{background:#23304a;color:white;border-color:#38507a}
    .grid{display:grid;grid-template-columns:1fr;gap:12px;padding:12px 12px 80px}
    .card{display:flex;gap:12px;background:var(--card);border:1px solid #212836;border-radius:16px;padding:12px;align-items:center;text-decoration:none;color:inherit}
    .art{width:72px;height:72px;border-radius:12px;background:linear-gradient(135deg,#2b3446,#3c5076);display:grid;place-items:center;color:#cfe1ff;font-weight:700}
    .meta{flex:1;min-width:0}
    .name{font-weight:700;font-size:15px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;margin-top:2px}
    .pill{display:inline-block;font-size:11px;color:#cfe1ff;background:#213256;border:1px solid #34518a;padding:2px 8px;border-radius:999px;margin-top:6px}
    .go{margin-left:auto}
    .btn{appearance:none;border:0;background:#3b6bd9;color:white;padding:10px 12px;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer}
    nav.bottom{position:fixed;left:0;right:0;bottom:0;background:#0f131b;border-top:1px solid #232a39;display:grid;grid-template-columns:repeat(3,1fr)}
    nav.bottom a{display:grid;place-items:center;padding:12px 6px;color:#b9c4d6;text-decoration:none;font-size:12px}
    nav.bottom a.active{color:white;font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="title">エテルナリア音楽館</div>
    <div class="tabs" id="tabs">
      <button class="tab active" data-filter="all">すべて</button>
      <button class="tab" data-filter="work">作業</button>
      <button class="tab" data-filter="peace">安らぎ</button>
      <button class="tab" data-filter="prayer">祈り</button>
      <button class="tab" data-filter="sleep">眠り</button>
    </div>
  </header>

  <main class="grid" id="list"></main>

  <nav class="bottom">
    <a href="index.html">ホーム</a>
    <a href="notice.html">お知らせ</a>
    <a href="mypage.html">マイページ</a>
  </nav>

<script>
const list = document.getElementById('list');
const tabs = document.getElementById('tabs');
let current = 'all';
let TRACKS = [];

function sec(s){const m=Math.floor(s/60);const r=('0'+Math.floor(s%60)).slice(-2);return `${m}:${r}`}
function label(k){return ({work:'作業',peace:'安らぎ',prayer:'祈り',sleep:'眠り'})[k]||k}

function draw(){
  list.innerHTML = '';
  TRACKS.filter(t=> current==='all' || t.mood===current).forEach(t=>{
    const a = document.createElement('a');
    a.className = 'card';
    a.href = `audio.html?id=${encodeURIComponent(t.id)}&from=music`;
    a.innerHTML = `
      <div class="art" aria-hidden="true">♪</div>
      <div class="meta">
        <div class="name">${t.name}</div>
        <div class="sub">${t.origin} ／ ${t.bpm} BPM ／ ${sec(t.duration)}</div>
        <span class="pill">${label(t.mood)}</span>
      </div>
      <div class="go"><button class="btn" type="button">聴く</button></div>`;
    list.appendChild(a);
  });
}

tabs.addEventListener('click', (e)=>{
  const b = e.target.closest('.tab'); if(!b) return;
  current = b.dataset.filter;
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  draw();
});

// ここで唯一のデータ源を読み込む
fetch('tracks.json')
  .then(r=>r.json())
  .then(json => { TRACKS = json; draw(); })
  .catch(()=>{ list.innerHTML = '<p>わかりません／情報が不足しています</p>'; });
</script>

</body>
</html>
