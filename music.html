<!DOCTYPE html>
{id:"t03", name:"竜歌：山影の火床", mood:"focus", bpm:120, duration:200, role:"Knight"},
{id:"t04", name:"竜歌：灯る鱗紋", mood:"rest", bpm:88, duration:160, role:"Lorekeeper"},
{id:"t05", name:"竜歌：眠りの風域", mood:"sleep", bpm:60, duration:600, role:"Disciple"},
{id:"t06", name:"竜歌：潮鳴りの記憶", mood:"rest", bpm:78, duration:190, role:"Stormblade"}
];
const list = document.getElementById('list');
const tabs = document.getElementById('tabs');
let current = 'all';


const todayRole = localStorage.getItem('todayRole'); // 例: "Wind Guide"
const badge = document.getElementById('todayBadge');
if(todayRole){ badge.hidden = false; badge.textContent = `今日の役割：${todayRole}`; }


function sec(s){const m=Math.floor(s/60);const r=('0'+Math.floor(s%60)).slice(-2);return `${m}:${r}`}
function label(k){return ({focus:'集中',rest:'休息',ritual:'祈り',sleep:'睡眠'})[k]||k}


function draw(){
list.innerHTML = '';
TRACKS.filter(t=> current==='all' || t.mood===current).forEach(t=>{
const a = document.createElement('a');
a.className = 'card';
a.href = `audio.html?id=${encodeURIComponent(t.id)}&from=music`;
a.dataset.role = t.role;
if(todayRole && t.role===todayRole){ a.classList.add('recommended'); }
a.innerHTML = `
<div class="art" aria-hidden="true">♪</div>
<div class="meta">
<div class="name">${t.name}</div>
<div class="sub">${t.role} ／ ${t.bpm} BPM ／ ${sec(t.duration)}</div>
<span class="pill">${label(t.mood)}</span>
</div>
<div class="go"><button class="btn" type="button">聴く</button></div>`;
list.appendChild(a);
})
}


tabs.addEventListener('click', (e)=>{
const b = e.target.closest('.tab');
if(!b) return;
current = b.dataset.filter;
document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
b.classList.add('active');
draw();
});


draw();
</script>
</body>
</html>
