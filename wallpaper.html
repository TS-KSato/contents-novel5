<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>壁紙一覧｜運命の銀竜暦</title>
<meta name="description" content="銀竜世界の壁紙をダウンロード" />
<style>
:root { --bg:#0d0f14; --card:#151922; --text:#e7ecf3; --muted:#9aa3b2; --acc:#6aa8ff; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
header{position:sticky;top:0;background:linear-gradient(180deg,#0d0f14 70%,#0d0f1400);padding:14px 16px 8px;z-index:10}
.title{font-weight:800;font-size:18px}
.filters{display:flex;gap:8px;margin-top:10px;overflow:auto;padding-bottom:6px}
.chip{padding:8px 12px;border-radius:999px;background:#1b2230;color:#cfe1ff;font-size:13px;white-space:nowrap;cursor:pointer;border:1px solid #273144}
.chip.active{background:#23304a;color:white;border-color:#38507a}
main{padding:12px 12px 84px}
.card{background:var(--card);border:1px solid #212836;border-radius:16px;margin-bottom:12px;overflow:hidden}
.hero{width:100%;aspect-ratio:9/16;background:linear-gradient(135deg,#263145,#3f5c8a)}
.wrap{padding:12px}
.name{font-weight:800}
.cap{color:var(--muted);font-size:13px;margin-top:6px;line-height:1.6}
.row{display:flex;gap:10px;align-items:center;margin-top:10px}
.pill{font-size:11px;color:#cfe1ff;background:#213256;border:1px solid #34518a;padding:2px 8px;border-radius:999px}
.btn{margin-left:auto;appearance:none;border:0;background:#3b6bd9;color:white;padding:10px 12px;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer}
nav.bottom{position:fixed;left:0;right:0;bottom:0;background:#0f131b;border-top:1px solid #232a39;display:grid;grid-template-columns:repeat(3,1fr)}
nav.bottom a{display:grid;place-items:center;padding:12px 6px;color:#b9c4d6;text-decoration:none;font-size:12px}
.note{color:#c8d4e8;font-size:12px;margin:6px 12px 0}
</style>
</head>
<body>
<header>
<div class="title">壁紙</div>
<div class="filters" id="filters">
<button class="chip" data-t="spring">春</button>
<button class="chip" data-t="summer">夏</button>
<button class="chip" data-t="autumn">秋</button>
<button class="chip" data-t="winter">冬</button>
<button class="chip" data-t="wind">元型：Wind</button>
<button class="chip" data-t="knight">元型：Knight</button>
<button class="chip active" data-t="all">すべて</button>
</div>
<p class="note">※ 端末の壁紙として使いやすい構図を選んでいます（ノッチ安全域考慮）。</p>
</header>


<main id="list"></main>


<nav class="bottom">
<a href="index.html">ホーム</a>
<a href="notice.html">お知らせ</a>
<a href="mypage.html">マイページ</a>
</nav>


<script>
const $list = document.getElementById('list');
const $filters = document.getElementById('filters');

let ALL = [];          // wallpapers.json の内容
let active = 'all';    // 現在のフィルタ

// 動的にタグチップを生成（世界内タグのみ）
function buildChips(tags){
  $filters.innerHTML = '';
  const make = (label, val, activeNow=false) => {
    const b = document.createElement('button');
    b.className = 'chip' + (activeNow ? ' active' : '');
    b.dataset.t = val;
    b.textContent = label;
    $filters.appendChild(b);
  };
  make('すべて', 'all', true);
  // アーキタイプを上位に（任意）
  Array.from(new Set(ALL.map(w=>w.archetype))).filter(Boolean).forEach(a=>{
    make(`元型：${a}`, `arch:${a}`);
  });
  // 世界内タグ
  tags.forEach(t=> make(t, `tag:${t}`));
}

function draw(){
  $list.innerHTML = '';
  const rows = ALL.filter(w=>{
    if(active==='all') return true;
    if(active.startsWith('arch:')) return w.archetype === active.slice(5);
    if(active.startsWith('tag:'))  return (w.tags||[]).includes(active.slice(4));
    return true;
  });

  rows.forEach(w=>{
    const a = document.createElement('article');
    a.className = 'card';
    a.innerHTML = `
      <img class="hero" src="${w.url}" alt="${w.name}" loading="lazy" decoding="async" />
      <div class="wrap">
        <div class="name">${w.name}</div>
        <p class="cap">${w.caption ?? ''}</p>
        <div class="row">
          ${w.archetype ? `<span class="pill">${w.archetype}</span>`:''}
          ${(w.tags||[]).slice(0,2).map(t=>`<span class="pill">${t}</span>`).join('')}
          <a class="btn" href="${w.url}" download>
            ${w.paid ? '購入後ダウンロード' : 'ダウンロード'}
          </a>
        </div>
      </div>`;
    $list.appendChild(a);
  });
  if (typeof gtagEvent === 'function' && rows.length) {
    gtagEvent('view_wallpaper', {count: rows.length}); // 同意後のみ発火される想定
  }
}

// フィルタ切替
$filters.addEventListener('click', e=>{
  const b = e.target.closest('.chip'); if(!b) return;
  active = b.dataset.t;
  document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  draw();
});

// データ読込（唯一のソース）
fetch('wallpapers.json')
  .then(r=>r.json())
  .then(json=>{
    ALL = json;
    const tagSet = new Set();
    ALL.forEach(w => (w.tags||[]).forEach(t => tagSet.add(t)));
    buildChips(Array.from(tagSet));
    draw();
  })
  .catch(()=>{
    $list.innerHTML = '<p class="note">わかりません／情報が不足しています</p>';
  });
</script>

</html>
