<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>壁紙一覧｜運命の銀竜暦</title>
<meta name="description" content="銀竜世界の壁紙をダウンロード" />
<style>
:root { --bg:#0d0f14; --card:#151922; --text:#e7ecf3; --muted:#9aa3b2; --acc:#6aa8ff; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
header{position:sticky;top:0;background:linear-gradient(180deg,#0d0f14 70%,#0d0f1400);padding:14px 16px 8px;z-index:10}
.title{font-weight:800;font-size:18px}
.filters{display:flex;gap:8px;margin-top:10px;overflow:auto;padding-bottom:6px}
.chip{padding:8px 12px;border-radius:999px;background:#1b2230;color:#cfe1ff;font-size:13px;white-space:nowrap;cursor:pointer;border:1px solid #273144}
.chip.active{background:#23304a;color:white;border-color:#38507a}
main{padding:12px 12px 84px}
.card{background:var(--card);border:1px solid #212836;border-radius:16px;margin-bottom:12px;overflow:hidden}
.hero{width:100%;aspect-ratio:9/16;background:linear-gradient(135deg,#263145,#3f5c8a)}
.wrap{padding:12px}
.name{font-weight:800}
.cap{color:var(--muted);font-size:13px;margin-top:6px;line-height:1.6}
.row{display:flex;gap:10px;align-items:center;margin-top:10px}
.pill{font-size:11px;color:#cfe1ff;background:#213256;border:1px solid #34518a;padding:2px 8px;border-radius:999px}
.btn{margin-left:auto;appearance:none;border:0;background:#3b6bd9;color:white;padding:10px 12px;border-radius:12px;font-weight:700;font-size:13px;cursor:pointer}
nav.bottom{position:fixed;left:0;right:0;bottom:0;background:#0f131b;border-top:1px solid #232a39;display:grid;grid-template-columns:repeat(3,1fr)}
nav.bottom a{display:grid;place-items:center;padding:12px 6px;color:#b9c4d6;text-decoration:none;font-size:12px}
.note{color:#c8d4e8;font-size:12px;margin:6px 12px 0}
</style>
</head>
<body>
<header>
<div class="title">壁紙</div>
<div class="filters" id="filters">
<button class="chip" data-t="human">人</button>
<button class="chip" data-t="elf">エルフ</button>
<button class="chip" data-t="dragon">竜</button>
<button class="chip" data-t="fairy">妖精</button>
<button class="chip active" data-t="all">すべて</button>
</div>
<p class="note">※ 端末の壁紙として使いやすい構図を選んでいます（ノッチ安全域考慮）。</p>
</header>


<main id="list"></main>


<nav class="bottom">
<a href="index.html">ホーム</a>
<a href="notice.html">お知らせ</a>
<a href="mypage.html">マイページ</a>
</nav>


<script>
// 追加：許可語彙
const ALLOWED_ARCH = new Set(["nature","life"]);
const ALLOWED_TAGS  = new Set(["dragon","human","elf","fairy"]);

// 追加：取込時に正規化
function normalize(w){
  // archetype 正規化（既存の Wind/Knight を暫定マップ。最終的には手で直す）
  const a = (w.archetype||"").toLowerCase();
  if (!ALLOWED_ARCH.has(a)) {
    w.archetype = (a==="nature") ? 
                 : (a==="life") ? 
                 : ""; // 不明は空（フィルタ対象外）
  }
  // tags 正規化：許可以外は落とす
  w.tags = (w.tags||[]).map(t=>String(t).toLowerCase()).filter(t=>ALLOWED_TAGS.has(t));
  return w;
}

// ... 既存の fetch 部分内で：
fetch('wallpapers.json')
  .then(r=>r.json())
  .then(json=>{
    ALL = json.map(normalize);  // ★ここで正規化
    // 固定順でフィルタチップを描画（順番を恣意的にしない・揺れない）
    const fixedTags = ["dragon","human","elf","fairy"].filter(t => ALL.some(w => (w.tags||[]).includes(t)));
    // buildChips を固定順で呼ぶ
    (function buildFixedChips(){
      const filters = document.getElementById('filters');
      filters.innerHTML = `
        <button class="chip" data-t="arch:nature">自然</button>
        <button class="chip" data-t="arch:life">生物</button>
        ${fixedTags.map(t=>`<button class="chip" data-t="tag:${t}">${({"dragon":"竜","human":"人","elf":"エルフ","fairy":"妖精"})[t]}</button>`).join("")}
        <button class="chip active" data-t="all">すべて</button>
      `;
    })();
    draw();
  })
  .catch(()=>{
    $list.innerHTML = '<p class="note">わかりません／情報が不足しています</p>';
  });
</script>


</html>
