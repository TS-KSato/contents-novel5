<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>運命の銀竜暦｜今日の導き手（有料）</title>
<meta name="description" content="月・日と性別を入力して、エテルナリアの主要登場人物9名から今日あなたを導く案内役を診断します。">
<style>
  :root{
    --bg:#0b0d12; --ink:#fff; --muted:#aeb7d0; --line:#27304a; --card:#151826;
    --primary:#1a3358; --primary-b:#34507c; --accent:#9fd3ff;
    --radius:16px; --pad:18px; --gap:12px; --tap:48px;
    --shadow:0 12px 28px rgba(0,0,0,.28);
  }
  *{box-sizing:border-box}
  html{font-size:16px}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
    line-height:1.7; -webkit-text-size-adjust:100%;
  }
  .wrap{max-width:40rem;margin:0 auto;padding:20px 14px 80px}

  header{text-align:center;margin:4px 0 14px}
  h1{margin:8px 0 4px;font-size:clamp(22px,6vw,28px);letter-spacing:.02em}
  .lead{color:var(--muted);font-size:15px;margin:4px auto 0;max-width:34rem}

  .card{
    background:var(--card); border:1px solid var(--line);
    border-radius:20px; padding:20px; box-shadow:var(--shadow); margin:14px 0;
  }
  .label{font-weight:800;color:#cfe1ff;margin:0 0 8px}

  .form{display:grid; grid-template-columns:1fr; row-gap:16px}
  .field{display:block}
  .field label{
    display:block; font-weight:700; font-size:15px; color:#d9e2ff; margin:0 0 6px;
  }
  select, button{
    width:100%; min-height:var(--tap); padding:12px 14px; border-radius:14px;
    border:1px solid var(--line); background:#1a2034; color:#fff; font-size:16px;
  }
  select:focus-visible, button:focus-visible{outline:2px solid var(--accent); outline-offset:2px}

  .radios{display:flex;gap:8px;flex-wrap:wrap}
  .radio{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--line);
    border-radius:999px;background:#11172a;cursor:pointer;user-select:none}
  .radio input{display:none}
  .radio input:checked+span{color:#fff}
  .radio span{color:#cfe1ff;font-size:14px}

  .primary{
    background:var(--primary); border-color:var(--primary-b); font-weight:800; letter-spacing:.02em;
  }
  .primary:hover{filter:brightness(1.05)}
  .cta-area{margin-top:10px}

  .partner{display:flex;gap:12px;align-items:center}
  .avatar{width:56px;height:56px;border-radius:50%;border:1px solid var(--line);
    background:#10172a;display:flex;align-items:center;justify-content:center;font-weight:800}
  .pname{font-weight:800}
  .prole{color:#cdd5ea;font-size:14px}
  .line{margin-top:6px;color:#e0e7ff;font-size:16px}

  .footnav{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  .pill{display:inline-flex;align-items:center;justify-content:center;min-height:44px;
    padding:10px 16px;border-radius:999px;border:1px solid var(--line);background:#11172a;
    color:#cfe1ff;text-decoration:none;font-size:14px}
  .pill:hover{background:#18213a}
  footer{text-align:center;color:var(--muted);font-size:12.5px;margin-top:12px}

  @media print{.footnav{display:none} body{background:#fff;color:#000} .card{border-color:#999;box-shadow:none}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>今日の導き手（有料）</h1>
      <p class="lead">
        ここはエテルナリアの星占術師による診断。<br>
        月・日と性別を選ぶと、今日あなたを導く案内役が現れます。
      </p>
    </header>

    <!-- 入力 -->
    <section class="card" aria-labelledby="lab-input">
      <div id="lab-input" class="label">入力</div>
      <div class="form" role="group" aria-label="誕生日と性別の入力">
        <div class="field">
          <label for="month">生まれた月</label>
          <select id="month" aria-label="月を選択">
            <option value="" hidden>月を選ぶ</option>
          </select>
        </div>

        <div class="field">
          <label for="day">生まれた日</label>
          <select id="day" aria-label="日を選択">
            <option value="" hidden>日を選ぶ</option>
          </select>
        </div>

        <div class="field">
          <label>性別</label>
          <div class="radios" role="group" aria-label="性別">
            <label class="radio"><input type="radio" name="gender" value="男性" checked><span>男性</span></label>
            <label class="radio"><input type="radio" name="gender" value="女性"><span>女性</span></label>
            <label class="radio"><input type="radio" name="gender" value="その他"><span>その他</span></label>
          </div>
        </div>
      </div>

      <div class="cta-area">
        <button id="btnGo" class="primary">今日の導き手を見る</button>
      </div>
      <p class="lead" style="margin-top:8px;font-size:13px">※生年月日は<strong>月と日</strong>のみ。年の入力は不要です。</p>
    </section>

    <!-- 結果 -->
    <section id="result" aria-live="polite"></section>

    <!-- 下部ナビ -->
    <section class="card" aria-label="ナビゲーション" style="text-align:center">
      <div class="footnav">
        <a href="./index.html" class="pill">← 占いトップ</a>
        <a href="./list.html" class="pill">おまけページ</a>
      </div>
    </section>
    <footer>© 運命の銀竜暦</footer>
  </div>

<script>
  /* セレクト初期化：月 1–12、日 初期 1–31（UX向上） */
  const monthSel=document.getElementById("month");
  const daySel=document.getElementById("day");

  for(let m=1;m<=12;m++){
    const o=document.createElement("option");
    o.value=String(m); o.textContent=String(m);
    monthSel.appendChild(o);
  }
  function buildDayOptions(n){
    daySel.innerHTML='<option value="" hidden>日を選ぶ</option>';
    for(let d=1; d<=n; d++){
      const o=document.createElement("option");
      o.value=String(d); o.textContent=String(d);
      daySel.appendChild(o);
    }
  }
  // 初期は 1–31 を表示（「日が選べない」問題を解消）
  buildDayOptions(31);

  function daysIn(m,y){
    return [31,((y%4===0&&y%100!==0)||y%400===0)?29:28,31,30,31,30,31,31,30,31,30,31][m-1];
  }
  function reflowDays(){
    const y=new Date().getFullYear();
    const m=Number(monthSel.value||0);
    if(!m){ buildDayOptions(31); return; }
    const n=daysIn(m,y);
    const prev = daySel.value;
    buildDayOptions(n);
    // 月変更後も可能なら選択を維持（大きすぎた場合は未選択に戻る）
    if(prev && Number(prev)<=n){ daySel.value=prev; }
  }
  monthSel.addEventListener("change", reflowDays);
  // ページ復帰（BFCache）対応
  window.addEventListener("pageshow", reflowDays);

  /* 決定ロジック（ダミーデータ） */
  const CHARACTERS=[
    {id:"alan",name:"アラン",role:"若き守り手",lines:["できることを三つ。終わったら胸を張ろう。","怖いなら一緒に行こう。足は二人分で軽くなる。"]},
    {id:"laila",name:"ライラ",role:"古き語り部",lines:["急ぐ話ほど腰を据えて聞こう。真は静けさの中にある。","休息は物語の間（ま）。間があるから響くのだ。"]},
    {id:"drake",name:"ドレイク",role:"勇者の剣士",lines:["刃を抜く前に、心を抜け。決めるのは覚悟だ。","仲間を信じろ。背中はそれで守られる。"]},
    {id:"nester",name:"ネスター",role:"風の導き手",lines:["高く飛べば遠くが見える。視点を変えるだけで解ける謎がある。","地図を広げよ。道は一本ではない。"]}
  ];
  function hashStr(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}
  function pick(len,seed){return hashStr(seed)%len;}
  function todayKey(){const d=new Date();return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;}

  const resultEl=document.getElementById("result");
  document.getElementById("btnGo").addEventListener("click",()=>{
    const mm = monthSel.value;
    const dd = daySel.value;
    if(!mm || !dd){
      alert("月と日を選んでください。");
      return;
    }
    const gender=document.querySelector('input[name="gender"]:checked')?.value||"未選択";
    const seed=`${todayKey()}|${mm}-${dd}|${gender}`;
    const p=CHARACTERS[pick(CHARACTERS.length,seed)];
    const line=p.lines[pick(p.lines.length,seed+"|l")];

    resultEl.innerHTML = `<div class="card" aria-labelledby="p-lab">
      <div id="p-lab" class="label">今日の導き手</div>
      <div class="partner">
        <div class="avatar" aria-hidden="true">${p.name.slice(0,2)}</div>
        <div><div class="pname">${p.name}</div><div class="prole">${p.role}</div></div>
      </div>
      <p class="line">「${line}」</p>
      <p class="lead" style="margin-top:6px;font-size:13px">
        ※ 本日は端末日付に基づき一意に決定されます。月・日・性別により、来訪者ごとに結果が異なる場合があります。
      </p>
    </div>`;
  });
</script>
</body>
</html>
