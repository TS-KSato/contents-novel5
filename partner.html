<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>運命の銀竜暦｜今日のパートナー（有料）</title>
  <meta name="description" content="月・日と性別を入力して、エテルナリアの主要登場人物9名から今日のパートナーを診断します。">
  <style>
    /* ===== ベース（zodiac 準拠 / スマホ前提） ===== */
    html { font-size: 16px; }
    :root{
      --bg:#0b0d12; --ink:#ffffff; --muted:#aeb7d0; --line:#27304a; --card:#151826;
      --accent:#9fd3ff; --accent-2:#1a3358; --accent-2-b:#34507c;
      --radius:.875rem; --pad:1rem; --gap:.75rem; --tap:2.75rem;
    }
    *{ box-sizing:border-box }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
      line-height:1.7; font-size:1rem; -webkit-text-size-adjust:100%;
    }
    .wrap{ max-width:40rem; margin:0 auto; padding:1.25rem 1rem 5.5rem; }

    /* ===== ヘッダー（最小限） ===== */
    header{ text-align:center; padding:.25rem .5rem 1rem; }
    header h1{ margin:.25rem 0 .25rem; font-size:clamp(1.25rem,6vw,1.6rem); letter-spacing:.02em; }
    .lead{ color:var(--muted); font-size:.9375rem; margin:.25rem auto 0; max-width:34rem; }

    /* ===== カード ===== */
    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:var(--radius); padding:var(--pad); margin:.75rem 0;
    }
    .label{ font-size:1rem; color:#cfe1ff; margin-bottom:.5rem; font-weight:800; }

    /* ===== 入力：常時1カラム（衝突防止） ===== */
    .controls{
      display:grid;
      grid-template-columns:1fr;
      row-gap:.9rem; /* 行間を明示して重なりを防止 */
    }
    .field{
      display:block; /* 縦積み */
    }
    .field label{
      display:block;
      font-size:.9rem;
      color:#cfe1ff;
      margin-bottom:.35rem;
      font-weight:700;
    }
    select, button{
      width:100%;
      font-size:1rem; min-height:var(--tap); border-radius:.625rem; border:1px solid var(--line);
      background:#1a2034; color:#fff; padding:.5rem .75rem;
    }
    button{ cursor:pointer }
    button:hover{ background:#232b45 }
    button:focus-visible, select:focus-visible{ outline:2px solid var(--accent); outline-offset:2px }

    /* 単位はセレクト直下に小さく表示（視線の流れが途切れない） */
    .unit{
      display:block;
      margin-top:.25rem;
      font-size:.8rem;
      color:#a9b7d7;
    }

    /* 性別ピル */
    .radios{ display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.25rem; }
    .radio{
      display:inline-flex; align-items:center; gap:.375rem;
      padding:.375rem .6rem; border:1px solid var(--line); border-radius:999px; background:#11172a;
      cursor:pointer; user-select:none;
    }
    .radio input{ display:none }
    .radio input:checked + span{ color:#fff; }
    .radio span{ color:#cfe1ff; font-size:.875rem }

    /* 結果表示 */
    .partner{ display:flex; gap:.75rem; align-items:center; flex-wrap:nowrap; }
    .avatar{
      width:3.5rem; height:3.5rem; border-radius:50%; border:1px solid var(--line);
      background:#10172a; display:flex; align-items:center; justify-content:center; font-weight:700;
    }
    .pname{ font-size:1.0625rem; font-weight:700 }
    .prole{ color:#cdd5ea; font-size:.875rem }
    .line{ margin-top:.375rem; color:#e0e7ff; font-size:1rem }

    /* フッターナビ（下部のみ） */
    footer{ text-align:center; color:var(--muted); font-size:.75rem; margin:1rem 0 .5rem }
    .footnav{ display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center; margin:.5rem 0 0 }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      color:var(--accent); text-decoration:none; background:#11172a; border:1px solid var(--line);
      padding:.5rem .75rem; border-radius:999px; font-size:.85rem; min-height:2.25rem;
    }
    .pill:hover{ background:#18213a }

    /* 印刷 */
    @media print{
      .footnav { display:none !important }
      body{ background:#fff; color:#000 }
      .card{ border-color:#999 }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>今日のパートナー（有料）</h1>
      <p class="lead">
        ここはエテルナリアの星占術師による診断です。<br>
        月・日と性別を選ぶと、今日あなたに寄り添うパートナーが現れます。
      </p>
    </header>

    <!-- 有料ゲート（デモ切替はUIのみ。判定は本番でサーバ側） -->
    <section id="gate" class="card" aria-live="polite">
      <div class="label">有料会員限定ページ</div>
      <p class="lead" style="margin:.25rem 0 .75rem; font-size:.9rem;">
        本番環境では有料会員のみ利用可能です。下の「デモ切替」で動作確認できます。
      </p>
      <div style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:center;">
        <span class="pill" id="statusPill">無料会員</span>
        <button id="toggleDemo" aria-pressed="false" style="width:auto;">（デモ）有料/無料 切替</button>
        <a href="./signup.html" class="pill" style="background:var(--accent-2); border-color:var(--accent-2-b); color:#fff;">会員登録へ</a>
      </div>
    </section>

    <!-- 入力（常時1カラム：月→日→性別） -->
    <section class="card" aria-labelledby="input-lab">
      <div id="input-lab" class="label">入力</div>
      <div class="controls" role="group" aria-label="誕生日と性別の入力">
        <div class="field">
          <label for="month">月</label>
          <select id="month" aria-label="月"></select>
          <small class="unit">例：5（＝5月）</small>
        </div>
        <div class="field">
          <label for="day">日</label>
          <select id="day" aria-label="日"></select>
          <small class="unit">例：12（＝12日）</small>
        </div>
        <div class="field">
          <label>性別</label>
          <div class="radios" role="group" aria-label="性別">
            <label class="radio"><input type="radio" name="gender" value="男性" checked><span>男性</span></label>
            <label class="radio"><input type="radio" name="gender" value="女性"><span>女性</span></label>
            <label class="radio"><input type="radio" name="gender" value="その他"><span>その他</span></label>
          </div>
        </div>
      </div>
      <div style="margin-top:.9rem;">
        <button id="btnGo">今日のパートナーを見る</button>
      </div>
      <p class="lead" style="margin-top:.5rem; font-size:.85rem;">※生年月日は<strong>月と日</strong>のみ。年の入力は不要です。</p>
    </section>

    <!-- 結果 -->
    <section id="result" aria-live="polite"></section>

    <!-- 下部ナビ -->
    <section class="card" aria-label="ナビゲーション" style="text-align:center;">
      <div class="footnav">
        <a href="./index.html" class="pill">← 占いトップ</a>
        <a href="./list.html" class="pill">おまけページ</a>
      </div>
    </section>
    <footer>© 運命の銀竜暦</footer>
  </div>

  <script>
    // ===== 有料デモ切替（本番はサーバ判定） =====
    let isPremium = false;
    const statusPill = document.getElementById("statusPill");
    const toggleDemo = document.getElementById("toggleDemo");
    toggleDemo.addEventListener("click", ()=>{
      isPremium = !isPremium;
      toggleDemo.setAttribute("aria-pressed", String(isPremium));
      statusPill.textContent = isPremium ? "有料会員（デモ）" : "無料会員";
    });

    // ===== データ（省略可：前回のまま） =====
    const CHARACTERS = [
      /* ...（前回と同じ配列。省略可。動作には必要）... */
    ];

    // ===== フォーム初期化（並び：月→日） =====
    const monthSel = document.getElementById("month");
    const daySel   = document.getElementById("day");

    for(let m=1;m<=12;m++){
      const o=document.createElement("option");
      o.value=o.textContent=m;
      monthSel.appendChild(o);
    }
    function daysIn(m, y){
      return [31, ( (y%4===0 && y%100!==0) || y%400===0 ) ? 29 : 28, 31,30,31,30,31,31,30,31,30,31][m-1];
    }
    function fillDays(){
      const y = new Date().getFullYear();
      const m = Number(monthSel.value||1);
      const n = daysIn(m, y);
      const prev = Number(daySel.value||1);
      daySel.innerHTML = "";
      for(let d=1; d<=n; d++){
        const o=document.createElement("option");
        o.value=o.textContent=d;
        daySel.appendChild(o);
      }
      if (prev<=n) daySel.value = String(prev);
    }
    monthSel.addEventListener("change", fillDays);
    fillDays();

    // ===== 決定ロジック =====
    function hashStr(s){ let h=2166136261>>>0; for(let i=0;i<s.length;i++){ h^=s.charCodeAt(i); h=Math.imul(h,16777619);} return h>>>0; }
    function pickIndex(len, seed){ return hashStr(seed) % len; }
    function todayKey(){
      const d = new Date();
      return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; // YYYY-M-D
    }
    function decidePartner(mm, dd, gender){
      const seed = `${todayKey()}|${mm}-${dd}|${gender}`;
      const pIdx = pickIndex(CHARACTERS.length, seed);
      const partner = CHARACTERS[pIdx];
      const lineIdx = pickIndex(partner.lines.length, seed+"|line");
      return { partner, line: partner.lines[lineIdx] };
    }

    // ===== 表示 =====
    const resultEl = document.getElementById("result");
    document.getElementById("btnGo").addEventListener("click", ()=>{
      if (!isPremium){
        resultEl.innerHTML = `
          <div class="card">
            <div class="label">ご利用には会員登録が必要です</div>
            <p class="lead" style="font-size:.9rem;">
              このページは有料会員限定です。<br>
              <a href="./signup.html" class="pill" style="margin-top:.5rem; display:inline-flex; background:var(--accent-2); border-color:var(--accent-2-b); color:#fff;">会員登録へ</a>
            </p>
          </div>`;
        return;
      }
      const mm = Number(monthSel.value||1);
      const dd = Number(daySel.value||1);
      const gender = (document.querySelector('input[name="gender"]:checked')?.value) || "未選択";
      const {partner, line} = decidePartner(mm, dd, gender);

      resultEl.innerHTML = `
        <div class="card" aria-labelledby="p-lab">
          <div id="p-lab" class="label">今日のパートナー</div>
          <div class="partner">
            <div class="avatar" aria-hidden="true">${partner.name.slice(0,2)}</div>
            <div>
              <div class="pname">${partner.name}</div>
              <div class="prole">${partner.role}</div>
            </div>
          </div>
          <p class="line">「${line}」</p>
          <p class="lead" style="margin-top:.5rem; font-size:.85rem;">
            ※ 本日は端末日付に基づき一意に決定されます。月・日・性別により、来訪者ごとに結果が異なる場合があります。
          </p>
        </div>
      `;
    });
  </script>
</body>
</html>
