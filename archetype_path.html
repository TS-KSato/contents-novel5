<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é‹å‘½ã®éŠ€ç«œæš¦ï½œé­‚ã®ç¾…é‡ç›¤ï¼ˆå…ƒå‹è¨ºæ–­ï¼‹ä»Šæ—¥ã®å½¹å‰²ï¼‰</title>
  <meta name="description" content="åˆå›ã®å…ƒå‹ï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰è¨ºæ–­ã§ã‚ãªãŸã®é­‚ã®æ€§è³ªã‚’ç¢ºç«‹ã—ã€æ¯æ—¥ã®10å•ã§ä»Šæ—¥ã®ã€å½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰ã€ã‚’æˆã‘ã¾ã™ã€‚">
  <style>
    :root{--bg:#0b0f14;--panel:#121821;--ink:#e9f1ff;--muted:#97a7c2;--line:#2a344d;--accent:#8dd0ff;--r:16px;--tap:48px}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;line-height:1.7}
    .wrap{max-width:760px;margin:auto;padding:16px 16px 92px}
    h1{font-size:clamp(22px,5vw,28px);margin:6px 0 8px}
    .lead{color:var(--muted);margin:0 0 12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--r);margin:12px 0;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .card-h{padding:12px 14px;font-weight:800;border-bottom:1px dashed rgba(141,208,255,.25)}
    .card-c{padding:12px 14px}
    .btn{appearance:none;border:none;cursor:pointer;width:100%;min-height:var(--tap);padding:12px;border-radius:12px;background:#17325a;border:1px solid #2e4c79;color:#fff;font-weight:800}
    .btn:hover{filter:brightness(1.05)}
    .btn.ghost{background:#121829}
    .grid2{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:640px){.grid2{grid-template-columns:1fr 1fr}}
    .q{margin:8px 0}
    .q .t{font-weight:700}
    .scale{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:8px}
    .scale input{display:none}
    .scale label{display:flex;align-items:center;justify-content:center;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f1626;color:#cfe1ff;cursor:pointer;user-select:none}
    .scale input:checked + label{background:#2b446d;color:#fff;box-shadow:0 0 0 2px rgba(141,208,255,.35) inset}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:rgba(141,208,255,.12);border:1px solid rgba(141,208,255,.25)}

    .result{animation:fade .6s ease both}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

    .bottom-nav{position:fixed;left:0;right:0;bottom:0;background:#121821;border-top:1px solid rgba(141,208,255,.25)}
    .bn-grid{display:grid;grid-template-columns:repeat(3,1fr);max-width:40rem;margin:0 auto}
    .bn-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:10px 0;color:var(--ink);text-decoration:none;font-size:14px}
    .bn-accent{background:rgba(141,208,255,.15)}
    .note{font-size:13px;color:var(--muted)}
    .kvs{display:grid;gap:6px}
    .kv{display:flex;gap:8px;align-items:flex-start}
    .kv dt{min-width:6rem;color:var(--muted)}
    .kv dd{margin:0}
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>é­‚ã®ç¾…é‡ç›¤</h1>
      <p class="lead">ã€Œãƒ«ãƒŠãƒ«ã®æ•™ãˆã‚’å—ã‘ç¶™ã„ã æ–°æ™‚ä»£ã®æ‹…ã„æ‰‹ã€ã¨ã—ã¦ã€<strong>åˆå›ã¯å…ƒå‹ï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰</strong>ã‚’ç¢ºç«‹ã—ã€<strong>ä»¥å¾Œã¯æ¯æ—¥ã®10å•</strong>ã§ä»Šæ—¥ã®å½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰ã‚’æˆã‹ã‚Šã¾ã™ã€‚</p>
    </header>

    <!-- Phase 1: å…ƒå‹è¨ºæ–­ï¼ˆåˆå›ã®ã¿è¡¨ç¤ºï¼‰ -->
    <section id="phase1" class="card" aria-labelledby="p1h" hidden>
      <div id="p1h" class="card-h">Phase 1ï¼šé­‚ã®å…±é³´è¨ºæ–­ï¼ˆåˆå›ï¼‰</div>
      <div class="card-c">
        <p class="note">ç›´æ„Ÿã§ãŠé¸ã³ãã ã•ã„ï¼ˆ5æ®µéšï¼‰ã€‚çµæœã¯ã€Œã‚¢ãƒ©ãƒ³ï¼ãƒ‰ãƒ¬ã‚¤ã‚¯ï¼ãƒã‚¹ã‚¿ãƒ¼ï¼ãƒªãƒªã‚¢ï¼ãƒ©ã‚¤ãƒ©ã€ã®ã„ãšã‚Œã‹ã®å…ƒå‹ã«ãªã‚Šã¾ã™ã€‚</p>

        <div class="q">
          <div class="t">Q1. äºŒã¤ã®ä¾¡å€¤ãŒå¯¾ç«‹ã™ã‚‹ã¨ãã€ã‚ãªãŸã¯ä½•ã‚’å„ªå…ˆã—ã¾ã™ã‹ï¼Ÿï¼ˆèª¿å’Œ â†” æ­£ã—ã•ï¼‰</div>
          <div class="scale" data-axis="logic"> 
            <input id="q1-1" type="radio" name="q1" value="1"><label for="q1-1">1</label>
            <input id="q1-2" type="radio" name="q1" value="2"><label for="q1-2">2</label>
            <input id="q1-3" type="radio" name="q1" value="3"><label for="q1-3">3</label>
            <input id="q1-4" type="radio" name="q1" value="4"><label for="q1-4">4</label>
            <input id="q1-5" type="radio" name="q1" value="5"><label for="q1-5">5</label>
          </div>
        </div>
        <div class="q">
          <div class="t">Q2. é€²ã‚€ã¹ãé“ã‚’æ±ºã‚ã‚‹ã¨ãã€ã‚ãªãŸã¯ï¼Ÿï¼ˆé¢¨ã®å›ã â†” å¤åœ°å›³ï¼‰</div>
          <div class="scale" data-axis="spirit">
            <input id="q2-1" type="radio" name="q2" value="1"><label for="q2-1">1</label>
            <input id="q2-2" type="radio" name="q2" value="2"><label for="q2-2">2</label>
            <input id="q2-3" type="radio" name="q2" value="3"><label for="q2-3">3</label>
            <input id="q2-4" type="radio" name="q2" value="4"><label for="q2-4">4</label>
            <input id="q2-5" type="radio" name="q2" value="5"><label for="q2-5">5</label>
          </div>
        </div>
        <div class="q">
          <div class="t">Q3. é¸ã³ã‚„ã™ã„è¡Œå‹•ã¯ï¼Ÿï¼ˆå†…çœ â†” è¡Œå‹•ï¼‰</div>
          <div class="scale" data-axis="vector">
            <input id="q3-1" type="radio" name="q3" value="1"><label for="q3-1">1</label>
            <input id="q3-2" type="radio" name="q3" value="2"><label for="q3-2">2</label>
            <input id="q3-3" type="radio" name="q3" value="3"><label for="q3-3">3</label>
            <input id="q3-4" type="radio" name="q3" value="4"><label for="q3-4">4</label>
            <input id="q3-5" type="radio" name="q3" value="5"><label for="q3-5">5</label>
          </div>
        </div>
        <div class="q">
          <div class="t">Q4. äººã¨ã®è·é›¢æ„Ÿã¯ï¼Ÿï¼ˆç‹¬ã‚Šã§æ•´ãˆã‚‹ â†” ä»²é–“ã¨å‹•ãï¼‰</div>
          <div class="scale" data-axis="social">
            <input id="q4-1" type="radio" name="q4" value="1"><label for="q4-1">1</label>
            <input id="q4-2" type="radio" name="q4" value="2"><label for="q4-2">2</label>
            <input id="q4-3" type="radio" name="q4" value="3"><label for="q4-3">3</label>
            <input id="q4-4" type="radio" name="q4" value="4"><label for="q4-4">4</label>
            <input id="q4-5" type="radio" name="q4" value="5"><label for="q4-5">5</label>
          </div>
        </div>

        <div class="grid2">
          <button id="btnP1" class="btn">å…ƒå‹ã‚’ç¢ºå®šã™ã‚‹</button>
          <button id="btnP1Reset" class="btn ghost" type="button">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
        </div>
        <p class="note">â€» å…ƒå‹ã¯ <code>localStorage.userArchetype</code> ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã€‚</p>
      </div>
    </section>

    <!-- Phase 1 çµæœï¼ˆç¢ºå®šå¾Œå¸¸ã«è¡¨ç¤ºï¼‰ -->
    <section id="archetypeBox" class="card result" aria-live="polite" hidden>
      <div class="card-h">ã‚ãªãŸã®å…ƒå‹ï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰</div>
      <div class="card-c" id="archText"></div>
    </section>

    <!-- Phase 2: æ¯æ—¥ã®10å• â†’ å½¹å‰²æ±ºå®š -->
    <section id="phase2" class="card" aria-labelledby="p2h" hidden>
      <div id="p2h" class="card-h">Phase 2ï¼šé­‚ã¸ã®åã®è³ªå•ï¼ˆä»Šæ—¥ã®å½¹å‰²ã‚’æ±ºã‚ã‚‹ï¼‰</div>
      <div class="card-c" id="qList">
        <!-- è³ªå•ã¯ JS ã§è‡ªå‹•ç”Ÿæˆï¼ˆ10å•ï¼‰ -->
      </div>
      <div class="card-c">
        <div class="grid2">
          <button id="btnEval" class="btn">ä»Šæ—¥ã®å½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰ã‚’æˆã‹ã‚‹</button>
          <button id="btnClearQ" class="btn ghost" type="button">å›ç­”ã‚¯ãƒªã‚¢</button>
        </div>
        <p class="note" style="margin-top:6px">â€» æ¯æ—¥ã®å›ç­”ã¯ä¿å­˜ã—ã¾ã›ã‚“ã€‚çµæœã‚«ãƒ¼ãƒ‰ã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      </div>
    </section>

    <!-- Phase 3+4: å½¹å‰²ï¼‹ç¥è¨— -->
    <section id="resultBox" class="card result" hidden>
      <div class="card-h">ä»Šæ—¥ã®æˆä¸ï¼šå½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰ã¨éŠ€ç«œã®è¨€è‘‰</div>
      <div class="card-c" id="roleText"></div>
    </section>

    <!-- æƒ…å ± -->
    <section class="card">
      <div class="card-h">ã“ã®ãƒšãƒ¼ã‚¸ã«ã¤ã„ã¦</div>
      <div class="card-c">
        <dl class="kvs">
          <div class="kv"><dt>ä¿å­˜</dt><dd>å…ƒå‹ã®ã¿ç«¯æœ«ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ï¼ˆå‰Šé™¤ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¯èƒ½ï¼‰</dd></div>
          <div class="kv"><dt>ç›®çš„</dt><dd>å˜ãªã‚‹ã‚¸ãƒ§ãƒ–è¨ºæ–­ã§ã¯ãªãã€ã€Œã‚ãªãŸã¯ã„ã‹ã«ç”Ÿãã‚‹ã¹ãã‹ã€ã‚’æ—¥ã€…ç¿»è¨³ã™ã‚‹ç¾…é‡ç›¤ã§ã™ã€‚</dd></div>
        </dl>
      </div>
    </section>
  </main>

  <!-- Bottom Nav (3 tabs) -->
  <nav class="bottom-nav" aria-label="ä¸»è¦ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
    <div class="bn-grid">
      <a class="bn-btn" href="./index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
      <a class="bn-btn" href="./notice.html">ğŸ“£ ãŠçŸ¥ã‚‰ã›</a>
      <a class="bn-btn" href="./mypage.html">ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
    </div>
  </nav>

<script>
// ========== ãƒ‡ãƒ¼ã‚¿ ==========
const ARCHETYPES = [
  {id:'alan',   name:'ã‚¢ãƒ©ãƒ³ã®é­‚ï¼ˆæ¶ã‘æ©‹ï¼‰', desc:'äºŒã¤ã®ä¸–ç•Œã®é–“ã«ç«‹ã¡ã€èª¿å’Œã¨ç†è§£ã‚’æ±‚ã‚ã‚‹è€…ã€‚'},
  {id:'drake',  name:'ãƒ‰ãƒ¬ã‚¤ã‚¯ã®é­‚ï¼ˆå®ˆè­·è€…ï¼‰', desc:'æ„›ã™ã‚‹è€…ã‚’å®ˆã‚‹ãŸã‚ã«ã€å›°é›£ã«ç«‹ã¡å‘ã‹ã†å¼·ã•ã¨è„†ã•ã‚’æŒã¤è€…ã€‚'},
  {id:'nester', name:'ãƒã‚¹ã‚¿ãƒ¼ã®é­‚ï¼ˆè¦³å¯Ÿè€…ï¼‰', desc:'é«˜ãè¦–ç‚¹ã‹ã‚‰æœ¬è³ªã‚’è¦‹æŠœãã€æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹çŸ¥æµã‚’æŒã¤è€…ã€‚'},
  {id:'lilia',  name:'ãƒªãƒªã‚¢ã®é­‚ï¼ˆè‡ªç”±ãªã‚‹é¢¨ï¼‰', desc:'å¥½å¥‡å¿ƒã«æº€ã¡ã€è‡ªç„¶ã¨å…±é³´ã—ã€å½¢ã«ç¸›ã‚‰ã‚ŒãšçœŸå®Ÿã‚’ä¼ãˆã‚‹è€…ã€‚'},
  {id:'laila',  name:'ãƒ©ã‚¤ãƒ©ã®é­‚ï¼ˆèªã‚Šéƒ¨ï¼‰', desc:'å¤ãçŸ¥æµã‚’å°Šã³ã€éå»ã‹ã‚‰å­¦ã³ã€æœªæ¥ã¸ç‰©èªã‚’ç¹‹ãè€…ã€‚'}
];

// å½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰å®šç¾©ï¼š4è»¸ãƒ™ã‚¯ãƒˆãƒ«ã§è¡¨ç¾ï¼ˆvector/basis/mood/socialï¼‰å„ -1..+1
//  å†…å‘(-1)/å¤–å‘(+1), èª¿å’Œ(-1)/è«–ç†(+1), é™å¯‚(-1)/æ¿€æƒ…(+1), å­¤ç‹¬(-1)/å…±åŒ(+1)
const ROLES = [
  {id:'disciple', name:'éŠ€ç«œã®å¾’ (Disciple)', v:[-1,-1,-1,-1], desc:'è–åŸŸã«ç•™ã¾ã‚Šã€æ•™ãˆã‚’å†…çœã—ã¦åŠ›ã‚’è“„ãˆã‚‹ã¹ãæ—¥ã€‚'},
  {id:'stormblade', name:'ã‚¹ãƒˆãƒ¼ãƒ ãƒ–ãƒ¬ã‚¤ãƒ‰ (Stormblade)', v:[+1,+1,+1,+1], desc:'ä»²é–“ã‚’å®ˆã‚Šã€æ­£é¢ã‹ã‚‰å›°é›£ã«æŒ‘ã‚€ã¹ãæ—¥ã€‚'},
  {id:'wind_guide', name:'é¢¨ã®å°ãæ‰‹ (Wind Guide)', v:[-1,-1,-1,+0], desc:'é«˜ãè¦–ç‚¹ã§è¦³å¯Ÿã—ã€æµã‚Œã«é€†ã‚‰ã‚ãšæœ¬è³ªã‚’è¦‹æŠœãæ—¥ã€‚'},
  {id:'lorekeeper', name:'å¤ãèªã‚Šéƒ¨ (Lorekeeper)', v:[-1,+1,-1,-1], desc:'æ›¸ã‚’é–‹ãã€çŸ¥ã®ç¶™æ‰¿ã‹ã‚‰æœªæ¥ã‚’è¦‹å‡ºã™æ—¥ã€‚'},
  {id:'knight', name:'ç‹å›½ã®é¨å£« (Knight)', v:[+1,+1,+1,+1], desc:'çµ„ç¹”ã®ä¸­ã§å½¹ç›®ã‚’æœãŸã—ã€ç§©åºã‚’å®ˆã‚‹æ—¥ã€‚'},
  {id:'healer', name:'è–åŸŸã®ç™’ã—æ‰‹ (Healer)', v:[-1,-1,-1,+1], desc:'ä»–è€…ã®ç—›ã¿ã«å¯„ã‚Šæ·»ã„ã€è‡ªç„¶ã®åŠ›ã§å’Œã‚‰ã’ã‚‹æ—¥ã€‚'}
];

// Phase2 è³ªå•ï¼šè»¸ãƒãƒƒãƒ”ãƒ³ã‚°
const QUESTIONS = [
  { id:1, text:'ä»Šæ—¥ã®ã‚ãªãŸã¯ã€ãƒ«ãƒŠãƒ«ã®å·£ã«ç•™ã¾ã‚‹ã‹ã€ãƒã‚¯ã‚µãƒ¼ãƒˆã®ç”ºã¸å‘ã‹ã†ã‹ï¼Ÿ', axis:'vector', left:'å·£ã«ç•™ã¾ã‚‹', right:'ç”ºã¸å‘ã‹ã†' },
  { id:2, text:'é“ã‚’é¸ã¶ãªã‚‰ã€é¢¨ã®å›ãã«è€³ã‚’æ¾„ã¾ã™ã‹ã€ãƒ©ã‚¤ãƒ©ã®å¤åœ°å›³ã‚’é ¼ã‚‹ã‹ï¼Ÿ', axis:'basis', left:'é¢¨ã®å›ã', right:'å¤åœ°å›³' },
  { id:3, text:'ã‚ãªãŸã®å¿ƒã¯ã€é™ã‹ãªè–åŸŸã®æ³‰ã‹ã€è’ã‚Œç‹‚ã†åµã®å‰£ã‹ï¼Ÿ', axis:'mood', left:'é™ã‹ãªæ³‰', right:'åµã®å‰£' },
  { id:4, text:'åŠ›ã‚’å¾—ã‚‹ãªã‚‰ã€ä¸€äººã§ç‘æƒ³ã™ã‚‹ã‹ã€ä»²é–“ã¨å…±ã«å„€å¼ã‚’è¡Œã†ã‹ï¼Ÿ', axis:'social', left:'ä¸€äººã§ç‘æƒ³', right:'ä»²é–“ã¨å„€å¼' },
  { id:5, text:'ä»Šã€å‘ãåˆã†ã¹ãã¯ã€è‡ªã‚‰ã®ææ€–ã‹ã€ç‹ã®é‡æœ›ã‹ï¼Ÿ', axis:'vector', left:'è‡ªã‚‰ã®ææ€–', right:'ç‹ã®é‡æœ›' },
  { id:6, text:'é­”æ³•ã‚’ç´¡ããªã‚‰ã€ãƒªãƒªã‚¢ã®ã‚ˆã†ã«èˆã†ã‹ã€ãƒã‚°ãƒŠã‚¹ã®ã‚ˆã†ã«è© å”±ã™ã‚‹ã‹ï¼Ÿ', axis:'basis', left:'ãƒªãƒªã‚¢ã®ã‚ˆã†ã«', right:'ãƒã‚°ãƒŠã‚¹ã®ã‚ˆã†ã«' },
  { id:7, text:'ãƒ«ãƒŠãƒ«ã®ã€Œå¤§åœ°å¸°é‚„ã€ã‚’å‰ã«ã—ãŸæ™‚ã€ã‚ãªãŸã¯ä½•ã‚’æ„Ÿã˜ã‚‹ã‹ï¼Ÿ', axis:'mood', left:'é™ã‹ãªå—å®¹', right:'é‹å‘½ã¸ã®æŠµæŠ—' },
  { id:8, text:'çŸ¥æµã‚’æ±‚ã‚ã‚‹ãªã‚‰ã€ãƒã‚¹ã‚¿ãƒ¼ã¨ã®å¯¾è©±ã‹ã€å­¦é™¢ã§ã®è­°è«–ã‹ï¼Ÿ', axis:'social', left:'ãƒã‚¹ã‚¿ãƒ¼ã¨ã®å¯¾è©±', right:'å­¦é™¢ã§ã®è­°è«–' },
  { id:9, text:'ä»Šæ—¥ã®ã‚ãªãŸã®æ‰‹ã¯ã€ä½•ã‚’æ±‚ã‚ã¦ã„ã‚‹ã‹ï¼Ÿ', axis:'vector', left:'é±—ã®ãŠå®ˆã‚Šã‚’æ¡ã‚‹', right:'å‰£ã®æŸ„ã‚’æ¡ã‚‹' },
  { id:10, text:'æœ‰é™ã®å‘½ã‚’å‰ã«ã—ã¦ã€ä½•ã‚’æ€ã†ã‹ï¼Ÿ', axis:'basis', left:'ç„¡é™ã®ä¾¡å€¤ã‚’è¦‹å‡ºã™', right:'æ°¸é ã‚’æ¸‡æœ›ã™ã‚‹' }
];

// ==========
const $ = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

function getArchetype(){ try{ return JSON.parse(localStorage.getItem('userArchetype')); }catch{return null} }
function setArchetype(obj){ localStorage.setItem('userArchetype', JSON.stringify(obj)); }

function renderArchetypeBox(){
  const a = getArchetype();
  if(!a){ $('#archetypeBox').hidden = true; return; }
  $('#archetypeBox').hidden = false;
  $('#archText').innerHTML = `<div class="pill">ç¢ºå®šæ¸ˆã¿ã®å…ƒå‹</div>
    <h3 style="margin:.5rem 0 0">${a.name}</h3>
    <p class="note" style="margin:.35rem 0 0">${a.desc}</p>
    <div class="grid2" style="margin-top:10px">
      <button class="btn ghost" id="btnChange">å…ƒå‹ã‚’ã‚„ã‚Šç›´ã™ï¼ˆã“ã®ç«¯æœ«ã®ã¿ï¼‰</button>
      <a class="btn" href="#p2h">åã®è³ªå•ã¸é€²ã‚€</a>
    </div>`;
  $('#btnChange').addEventListener('click', ()=>{
    if(confirm('å…ƒå‹ã‚’æœªè¨­å®šã«æˆ»ã—ã¾ã™ã‹ï¼Ÿï¼ˆã“ã®ç«¯æœ«ã®ã¿ï¼‰')){ localStorage.removeItem('userArchetype'); apply(); }
  });
}

function showPhase1IfNeeded(){
  const has = !!getArchetype();
  $('#phase1').hidden = has; // åˆå›ã®ã¿è¡¨ç¤º
  $('#phase2').hidden = !has; // å…ƒå‹ãŒã‚ã‚Œã°è³ªå•ã‚’è¡¨ç¤º
}

function normalize5(v){ // 1..5 â†’ -1..+1
  return (Number(v)-3)/2; // 1:-1, 3:0, 5:+1
}

function pickArchetypeFromAnswers(ans){
  // ã–ã£ãã‚Šé‡ã¿ä»˜ã‘ï¼š
  // èª¿å’Œ(â‰¤0) â†’ ã‚¢ãƒ©ãƒ³/ãƒã‚¹ã‚¿ãƒ¼/ãƒªãƒªã‚¢ã€ è«–ç†(>0) â†’ ãƒ‰ãƒ¬ã‚¤ã‚¯/ãƒ©ã‚¤ãƒ©
  // å¤–å‘(>0) â†’ ãƒ‰ãƒ¬ã‚¤ã‚¯å¯„ã‚Šã€ å†…å‘(â‰¤0) â†’ ãƒ©ã‚¤ãƒ©/ãƒã‚¹ã‚¿ãƒ¼å¯„ã‚Š
  // ç°¡æ˜“ã‚¹ã‚³ã‚¢ã§æœ€å¤§ã®ã‚­ãƒ£ãƒ©ã‚’æ¡ç”¨
  const s = {alan:0, drake:0, nester:0, lilia:0, laila:0};
  const logic = ans.logic; const spirit = ans.spirit; const vector = ans.vector; const social = ans.social;
  if(logic>0){ s.drake+=1; s.laila+=1; } else { s.alan+=1; s.nester+=1; s.lilia+=1; }
  if(vector>0){ s.drake+=1; } else { s.laila+=0.5; s.nester+=0.5; s.alan+=0.5; }
  if(spirit<0){ s.lilia+=1; s.nester+=0.5; } else { s.laila+=0.7; }
  if(social>0){ s.alan+=0.4; s.drake+=0.4; } else { s.nester+=0.4; s.laila+=0.4; }
  const bestId = Object.entries(s).sort((a,b)=>b[1]-a[1])[0][0];
  return ARCHETYPES.find(a=>a.id===bestId);
}

function buildP1(){
  // nothing (é™çš„HTMLã§ç”¨æ„æ¸ˆã¿)
  $('#btnP1').addEventListener('click', ()=>{
    // é›†è¨ˆ
    const vals = {logic:null, spirit:null, vector:null, social:null};
    $$('#phase1 .scale').forEach(el=>{
      const name = el.previousElementSibling?.previousElementSibling ? null : null; // unused
      const axis = el.getAttribute('data-axis');
      const v = (el.querySelector('input:checked')||{}).value;
      vals[axis] = normalize5(v||3);
    });
    if(Object.values(vals).some(v=>v===null)){
      alert('å…¨ã¦ã®è¨­å•ã«ãŠç­”ãˆãã ã•ã„'); return;
    }
    const a = pickArchetypeFromAnswers(vals);
    setArchetype(a); apply();
    window.scrollTo({top:0, behavior:'smooth'});
  });
  $('#btnP1Reset').addEventListener('click', ()=>{
    $$('.scale input:checked').forEach(i=>i.checked=false);
  });
}

function buildPhase2(){
  const box = $('#qList'); box.innerHTML='';
  QUESTIONS.forEach(q=>{
    const row = document.createElement('div'); row.className='q';
    row.innerHTML = `<div class="t">${q.id}. ${q.text}</div>`;
    const scale = document.createElement('div'); scale.className='scale'; scale.setAttribute('data-axis', q.axis);
    for(let i=1;i<=5;i++){
      const id = `p2q${q.id}-${i}`;
      const inp = document.createElement('input'); inp.id=id; inp.type='radio'; inp.name=`qq${q.id}`; inp.value=String(i);
      const lab = document.createElement('label'); lab.setAttribute('for', id); lab.textContent = i===1?q.left:(i===5?q.right:String(i));
      scale.appendChild(inp); scale.appendChild(lab);
    }
    row.appendChild(scale); box.appendChild(row);
  });

  $('#btnEval').addEventListener('click', ()=>{
    const axes = { vector:0, basis:0, mood:0, social:0 };
    let answered = true;
    $$('#qList .scale').forEach(sc=>{
      const v = (sc.querySelector('input:checked')||{}).value;
      if(!v){ answered=false; }
      const axis = sc.getAttribute('data-axis');
      axes[axis]+= normalize5(v||3);
    });
    if(!answered){ alert('ã¾ã æœªå›ç­”ã®è¨­å•ãŒã‚ã‚Šã¾ã™'); return; }
    // æ­£è¦åŒ–ï¼ˆå¹³å‡ï¼‰
    axes.vector/=3; axes.basis/=3; axes.mood/=3; axes.social/=2;

    // è¿‘ã„å½¹å‰²ã‚’é¸ã¶ï¼ˆãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ï¼‰
    const vec = [axes.vector, axes.basis, axes.mood, axes.social];
    let best=ROLES[0], bestDist=1e9;
    for(const r of ROLES){
      const d = Math.hypot(r.v[0]-vec[0], r.v[1]-vec[1], r.v[2]-vec[2], r.v[3]-vec[3]);
      if(d<bestDist){ best=r; bestDist=d; }
    }

    // ç¥è¨—ãƒ†ã‚­ã‚¹ãƒˆ
    const arch = getArchetype() || ARCHETYPES[0];
    const oracle = buildOracle(arch.id, best.id);

    $('#resultBox').hidden=false;
    $('#roleText').innerHTML = `
      <div class="pill">ä»Šæ—¥ã®å½¹å‰²ï¼ˆãƒ‘ã‚¹ï¼‰</div>
      <h3 style="margin:.5rem 0 0">${best.name}</h3>
      <p class="note" style="margin:.25rem 0 8px">${best.desc}</p>
      <div class="pill">ã‚ãªãŸã®å…ƒå‹</div>
      <p style="margin:.35rem 0 8px"><strong>${arch.name}</strong></p>
      <hr style="border:0;border-top:1px dashed rgba(141,208,255,.25);margin:10px 0">
      <h3 style="margin:.25rem 0 .5rem">éŠ€ç«œã®è¨€è‘‰ï¼ˆç¥è¨—ï¼‰</h3>
      <blockquote style="margin:0;border-left:3px solid rgba(141,208,255,.4);padding:8px 10px;background:#0f1626">${oracle}</blockquote>
    `;

    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«èª˜å°
    $('#resultBox').scrollIntoView({behavior:'smooth', block:'start'});
    window.dataLayer = window.dataLayer || []; window.dataLayer.push({event:'eval_path', role:best.id});
  });

  $('#btnClearQ').addEventListener('click', ()=>{
    $$('#qList input:checked').forEach(i=>i.checked=false);
  });
}

function buildOracle(archId, roleId){
  const samples = {
    'alan|stormblade': 'æ¶ã‘æ©‹ã¨ãªã‚‹è€…ã‚ˆã€‚ä»Šæ—¥ã¯å¸«ã®å‰£ã‚’å–ã‚Œã€‚èª¿å’Œã‚’èªã‚‹ã‚ˆã‚Šã‚‚ã€å®ˆã‚‹ãŸã‚ã«ä¸€æ­©ã‚’è¸ã¿å‡ºã™æ™‚ã ã€‚åµã¯å‚·ã‚’ä¸ãˆã‚‹ãŒã€ãã®ç—›ã¿ãŒæ˜æ—¥ã‚’ç¹‹ãã€‚',
    'drake|disciple': 'å®ˆè­·è€…ã‚ˆã€‚å‰£ã‚’ç½®ãã€è–åŸŸã®é™ã‘ã•ã«è€³ã‚’æ¾„ã¾ã›ã€‚å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã‚‚ã¾ãŸå¼·ã•ã ã€‚æœ‰é™ã®ã†ã¡ã«ç„¡é™ã®ä¾¡å€¤ã‚’è¦‹ã‚ˆã€‚',
    'nester|knight': 'è¦³å¯Ÿè€…ã‚ˆã€‚ä»Šæ—¥ã¯é›²ã‚’é™ã‚Šã€äººã®å–¶ã¿ã«èº«ã‚’ç½®ã‘ã€‚é§ã®é‡ã¿ã¯ã€ç†è§£ã®é‡ã¿ã€‚æã‚Œã‚‚å¸Œæœ›ã‚‚ã€è‚Œã§çŸ¥ã‚Œã€‚'
  };
  const k = `${archId}|${roleId}`;
  if(samples[k]) return `ã€Œ${samples[k]}ã€`;

  const archName = (ARCHETYPES.find(a=>a.id===archId)||ARCHETYPES[0]).name.split('ï¼ˆ')[0];
  const roleName = (ROLES.find(r=>r.id===roleId)||ROLES[0]).name.split(' ')[0];
  return `ã€Œ${archName}ã‚ˆã€‚ä»Šæ—¥ã¯ã€${roleName}ã€ã¨ã—ã¦æ­©ã‚ã€‚ææ€–ã§ã¯ãªãæ„›ã‚’é¸ã³ã€æµã‚Œã¨èª¿å’Œã—ãªãŒã‚‰ä¸€æ­©ã‚’é€²ã‚ã€‚æœ‰é™ã®æ™‚ã«ã“ãã€åŠ›ã¯æ­£ã—ãè¼ãã€‚ã€`;
}

function apply(){
  renderArchetypeBox();
  showPhase1IfNeeded();
}

function start(){
  // Phase1 ãƒ“ãƒ«ãƒ‰
  buildP1();
  // Phase2ï¼ˆ10å•ï¼‰
  buildPhase2();
  // åˆæœŸè¡¨ç¤º
  apply();
  // Bottom Nav ç¾åœ¨åœ°
  const path = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('.bottom-nav a').forEach(a=>{
    const href = a.getAttribute('href')||''; if(href.endsWith(path)){ a.classList.add('bn-accent'); a.setAttribute('aria-current','page'); }
  });
}
start();
</script>
</body>
</html>
